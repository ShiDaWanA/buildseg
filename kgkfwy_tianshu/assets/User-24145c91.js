import{B as O}from"./BaseTitle-588acb84.js";import{d as j,r as p,a as J,D as U,H as K,l as f,c as d,e as k,h as e,f as Q,w as t,F as w,o as _,i as c,t as W,g as n,q as I,m as L,E as X,a5 as Z}from"./index-ab68adb5.js";import{c as ee}from"./format-aee67674.js";const ne=j({__name:"User",setup(le){const m=p(!1),h=p([]),x=p([]),y=p([]),g=p();let a=p({id:void 0,name:"",organizationId:"",roleId:"",contactPerson:"",phone:"",isLocked:!1,expireDate:""});const z=J({name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:16,message:"长度在 3 到 16 个字符",trigger:"blur"}],organizationId:[{required:!0,message:"请选择机构",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}]}),v=p(""),B=U(()=>h.value.filter(r=>!v.value||r.name.toLowerCase().includes(v.value.toLowerCase()))),M=U(()=>a.value.id?"编辑":"新建");K(async()=>{y.value=await f.get("/api/Organization/GetAll"),x.value=await f.get("/api/User/GetRoleAll"),V()});const V=()=>{f.get("api/user/GetAll").then(r=>{h.value=r})},q=()=>{var r;(r=g.value)==null||r.resetFields(),a.value.id=void 0},N=()=>{m.value=!0},P=()=>{var r;(r=g.value)==null||r.validate(o=>{if(o){let s=a.value.id?"Update":"Create";f.post(`api/User/${s}`,a.value).then(()=>{m.value=!1,V(),X({message:"提交成功",type:"success"})})}})},T=r=>{m.value=!0,Z(()=>{a.value={...r}})},A=r=>{f.post("/api/User/Delete/"+r.id).then(()=>{V()})};return(r,o)=>{const s=d("el-button"),b=d("el-input"),E=d("el-divider"),i=d("el-table-column"),Y=d("el-popconfirm"),$=d("el-table"),u=d("el-form-item"),C=d("el-option"),D=d("el-select"),F=d("el-switch"),G=d("el-date-picker"),R=d("el-form"),S=d("el-dialog");return _(),k(w,null,[e(O,{title:"用户管理",icon:"icon-account"}),Q("div",null,[e(s,{type:"primary",onClick:N},{default:t(()=>[c("新建用户")]),_:1}),e(b,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=l=>v.value=l),modelModifiers:{trim:!0},style:{width:"300px","margin-left":"16px"},placeholder:"输入关键字搜索",clearable:""},null,8,["modelValue"])]),e(E),e($,{data:B.value,height:"calc(100vh - 223px)"},{default:t(()=>[e(i,{type:"index",width:"50"}),e(i,{prop:"name",label:"用户名"}),e(i,{prop:"organizationName",label:"所属机构"}),e(i,{prop:"roleName",label:"用户角色"}),e(i,{prop:"contactPerson",label:"姓名"}),e(i,{prop:"phone",label:"联系电话"}),e(i,{prop:"isLocked",label:"是否锁定"},{default:t(l=>[c(W(n(ee)(l.row.isLocked)),1)]),_:1}),e(i,{prop:"expireDate",label:"过期时间",width:"160"}),e(i,{prop:"created",label:"创建时间",width:"160"}),e(i,{width:"150","class-name":"hover-to-show"},{default:t(l=>[e(s,{type:"primary",link:"",onClick:H=>T(l.row)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"]),e(Y,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此用户么?",onConfirm:H=>A(l.row)},{reference:t(()=>[e(s,{type:"danger",link:""},{default:t(()=>[c("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(S,{title:M.value,modelValue:m.value,"onUpdate:modelValue":o[9]||(o[9]=l=>m.value=l),"close-on-click-modal":!1,width:"500px",onClosed:q},{footer:t(()=>[e(s,{onClick:o[8]||(o[8]=l=>m.value=!1)},{default:t(()=>[c("取消")]),_:1}),e(s,{type:"primary",onClick:P},{default:t(()=>[c("提交")]),_:1})]),default:t(()=>[e(R,{model:n(a),rules:z,ref_key:"formRef",ref:g,"label-position":"top"},{default:t(()=>[e(u,{label:"用户名",prop:"name"},{default:t(()=>[e(b,{modelValue:n(a).name,"onUpdate:modelValue":o[1]||(o[1]=l=>n(a).name=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),e(u,{label:"所属机构",prop:"organizationId"},{default:t(()=>[e(D,{modelValue:n(a).organizationId,"onUpdate:modelValue":o[2]||(o[2]=l=>n(a).organizationId=l),filterable:"",placeholder:"请选择机构",style:{width:"100%"}},{default:t(()=>[(_(!0),k(w,null,I(y.value,l=>(_(),L(C,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"用户角色",prop:"roleId"},{default:t(()=>[e(D,{modelValue:n(a).roleId,"onUpdate:modelValue":o[3]||(o[3]=l=>n(a).roleId=l),filterable:"",placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(_(!0),k(w,null,I(x.value,l=>(_(),L(C,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"是否锁定",prop:"isLocked"},{default:t(()=>[e(F,{modelValue:n(a).isLocked,"onUpdate:modelValue":o[4]||(o[4]=l=>n(a).isLocked=l)},null,8,["modelValue"])]),_:1}),e(u,{label:"过期时间",prop:"expireDate"},{default:t(()=>[e(G,{modelValue:n(a).expireDate,"onUpdate:modelValue":o[5]||(o[5]=l=>n(a).expireDate=l),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(u,{label:"姓名",prop:"contactPerson"},{default:t(()=>[e(b,{modelValue:n(a).contactPerson,"onUpdate:modelValue":o[6]||(o[6]=l=>n(a).contactPerson=l)},null,8,["modelValue"])]),_:1}),e(u,{label:"联系电话",prop:"phone"},{default:t(()=>[e(b,{modelValue:n(a).phone,"onUpdate:modelValue":o[7]||(o[7]=l=>n(a).phone=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])],64)}}});export{ne as default};
