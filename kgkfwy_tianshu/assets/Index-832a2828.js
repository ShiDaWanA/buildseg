import{B as te}from"./BaseTitle-588acb84.js";import{d as oe,r as p,a as ae,D as ne,H as se,l as V,c as n,e as h,h as e,f as _,w as o,F as P,o as f,i,t as w,g as u,q as re,m as L,z as C,E as D}from"./index-ab68adb5.js";import{u as ue,B as ie}from"./useSetting-1e631b4e.js";const de={class:"flex-gap-8"},pe={style:{display:"flex","justify-content":"space-between"}},me={key:0},ce={key:0},fe=_("i",{class:"el-icon-upload"},null,-1),_e=_("div",{class:"el-upload__text"},[i("将模型文件拖到此处，或"),_("em",null,"点击上传")],-1),Ve=oe({__name:"Index",setup(be){const{taskTypeList:S,getTaskTypeName:$}=ue(),E={children:"trains",label:"name",value:"id",emitPath:!1,disabled:"isPublish"},T=p([]),R=p();let r=p({trainId:"",name:"",desc:"",minResolution:0,maxResolution:10});const z=ae({name:[{required:!0,message:"请请输入名称",trigger:"blur"}],trainId:[{required:!0,message:"请选择训练结果",trigger:"change"}],minResolution:[{required:!0,message:"输入分辨率",trigger:"blur"},{type:"number",min:0,message:"请输入大于0的数字"}],maxResolution:[{required:!0,message:"输入分辨率",trigger:"blur"},{type:"number",min:0,message:"请输入大于0的数字"}]}),v=p(""),G=ne(()=>T.value.filter(a=>!v.value||a.name.toLowerCase().includes(v.value.toLowerCase())||a.desc.toLowerCase().includes(v.value.toLowerCase()))),g=p(!1),b=p(!1);se(async()=>{x(),H()});const B=p();let M;const j=a=>{M.append("files",a.file)},k=p(0),A=()=>{var a;M=new FormData,(a=B.value)==null||a.submit(),V.post("api/Model/Upload",M,{onUploadProgress:l=>{k.value=Math.floor(l.loaded*100/l.total)}}).then(()=>{b.value=!1,k.value=0,D({type:"success",message:"导入成功"}),x()})},x=()=>{V.get("api/Model/GetModels").then(a=>{T.value=a})},I=p({}),H=()=>{V.get("api/Train/GetAll").then(a=>{let l=S.map(s=>({name:s.title,type:s.name,trains:[],leaf:!1}));a.forEach(s=>{let c=l.find(U=>U.type==s.type);c==null||c.trains.push(s)}),I.value=l})},J=()=>{var a;(a=R.value)==null||a.resetFields()},K=()=>{var a;(a=R.value)==null||a.validate(l=>{l&&V.post("api/Model/Create",r.value).then(()=>{g.value=!1,x(),D({type:"success",message:"新建成功"})})})},O=a=>{V.post("/api/Model/Delete/"+a.id).then(()=>{x(),D({type:"success",message:"删除成功"})})};return(a,l)=>{const s=n("el-button"),c=n("el-input"),U=n("el-divider"),d=n("el-table-column"),Q=n("el-popconfirm"),W=n("el-table"),X=n("el-cascader"),y=n("el-form-item"),F=n("el-input-number"),q=n("el-col"),Y=n("el-row"),Z=n("el-form"),N=n("el-dialog"),ee=n("el-upload"),le=n("el-progress");return f(),h(P,null,[e(te,{title:"模型管理",icon:"icon-box"}),_("div",null,[e(s,{type:"primary",onClick:l[0]||(l[0]=t=>g.value=!0)},{default:o(()=>[i("新建模型")]),_:1}),e(s,{type:"primary",plain:"",onClick:l[1]||(l[1]=t=>b.value=!0)},{default:o(()=>[i("导入模型")]),_:1}),e(c,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=t=>v.value=t),modelModifiers:{trim:!0},style:{width:"300px","margin-left":"16px"},placeholder:"请输入关键字搜索",clearable:""},null,8,["modelValue"])]),e(U),e(W,{data:G.value,"default-sort":{prop:"created",order:"descending"},height:"calc(100vh - 223px)"},{default:o(()=>[e(d,{type:"index",width:"50"}),e(d,{prop:"modelName",label:"模型名称"}),e(d,{prop:"type",label:"模型类型"},{default:o(t=>[i(w(u($)(t.row.type)),1)]),_:1}),e(d,{label:"模型标签"},{default:o(t=>[_("div",de,[(f(!0),h(P,null,re(t.row.tags,m=>(f(),L(ie,{key:m.id,name:m.name,color:m.color},null,8,["name","color"]))),128))])]),_:1}),e(d,{prop:"modelDesc",label:"模型描述"}),e(d,{label:"发布方式",width:"90"},{default:o(t=>[i(w(t.row.viaUpload?"上传":"自训练"),1)]),_:1}),e(d,{prop:"minResolution",label:"解译最高分辨率"}),e(d,{prop:"maxResolution",label:"解译最低分辨率"}),e(d,{prop:"published",label:"发布时间",sortable:"",width:"150"}),e(d,{width:"120","class-name":"hover-to-show"},{default:o(t=>[e(s,{link:"",type:"info",disabled:""},{default:o(()=>[i("下载")]),_:1}),e(Q,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此模型么?",onConfirm:m=>O(t.row)},{reference:o(()=>[e(s,{type:"danger",link:""},{default:o(()=>[i("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(N,{title:"新建模型",modelValue:g.value,"onUpdate:modelValue":l[9]||(l[9]=t=>g.value=t),"close-on-click-modal":!1,width:"500px",onClosed:J},{footer:o(()=>[e(s,{onClick:l[8]||(l[8]=t=>g.value=!1)},{default:o(()=>[i("取消")]),_:1}),e(s,{type:"primary",onClick:K},{default:o(()=>[i("提交")]),_:1})]),default:o(()=>[e(Z,{model:u(r),rules:z,ref_key:"formRef",ref:R,"label-position":"top"},{default:o(()=>[e(y,{label:"训练结果",prop:"trainId"},{default:o(()=>[e(X,{ref:"cascader",modelValue:u(r).trainId,"onUpdate:modelValue":l[3]||(l[3]=t=>u(r).trainId=t),props:E,placeholder:"请选择训练结果",options:I.value,style:{width:"100%"}},{default:o(({node:t,data:m})=>[_("div",pe,[_("span",null,[i(w(m.name)+" ",1),t.isLeaf?(f(),h("span",me," ("+w(m.version)+")",1)):C("",!0)]),t.isLeaf?(f(),h("span",ce,w(m.isPublish?"已发布":""),1)):C("",!0)])]),_:1},8,["modelValue","options"])]),_:1}),e(y,{label:"模型名称",prop:"name"},{default:o(()=>[e(c,{modelValue:u(r).name,"onUpdate:modelValue":l[4]||(l[4]=t=>u(r).name=t),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),e(Y,{gutter:24},{default:o(()=>[e(q,{span:12},{default:o(()=>[e(y,{label:"解译最高分辨率",prop:"minResolution"},{default:o(()=>[e(F,{modelValue:u(r).minResolution,"onUpdate:modelValue":l[5]||(l[5]=t=>u(r).minResolution=t),modelModifiers:{number:!0},step:.5,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{span:12},{default:o(()=>[e(y,{label:"解译最低分辨率",prop:"maxResolution"},{default:o(()=>[e(F,{modelValue:u(r).maxResolution,"onUpdate:modelValue":l[6]||(l[6]=t=>u(r).maxResolution=t),modelModifiers:{number:!0},step:.5,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{label:"模型描述",prop:"desc"},{default:o(()=>[e(c,{type:"textarea",modelValue:u(r).desc,"onUpdate:modelValue":l[7]||(l[7]=t=>u(r).desc=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(N,{title:"上传模型",modelValue:b.value,"onUpdate:modelValue":l[11]||(l[11]=t=>b.value=t),"close-on-click-modal":!1,width:"500px"},{footer:o(()=>[e(s,{onClick:l[10]||(l[10]=t=>b.value=!1)},{default:o(()=>[i("取消")]),_:1}),e(s,{type:"primary",onClick:A},{default:o(()=>[i("提交")]),_:1})]),default:o(()=>[b.value?(f(),L(ee,{key:0,ref_key:"uploadRef",ref:B,"auto-upload":!1,"http-request":j,action:"",accept:".zip","on-success":a.uploadSuccess,"on-error":a.uploadError,limit:1,drag:""},{default:o(()=>[fe,_e]),_:1},8,["on-success","on-error"])):C("",!0),k.value!=0?(f(),L(le,{key:1,"stroke-width":4,percentage:k.value},null,8,["percentage"])):C("",!0)]),_:1},8,["modelValue"])],64)}}});export{Ve as default};
