import{d as pe,r as _,a as me,D as ce,H as _e,I as fe,a9 as ge,l as C,c as d,e as V,h as e,f as r,w as t,F as y,o as f,i,t as F,g as s,J as D,K as N,q as z,G as ve,m as G,E as be,p as he,n as xe,_ as Ve}from"./index-ab68adb5.js";import{B as ye}from"./BaseTitle-588acb84.js";import{T as ke}from"./TaskInfo-d2a2e698.js";import{u as we,T,B as Se}from"./useSetting-1e631b4e.js";import{T as Ie}from"./TaskProgress-8f20ffc2.js";import{H as Ce}from"./HubConnectionBuilder-04baf802.js";import"./index.esm.min-90f1887f.js";import"./install-7ec1e6c2.js";import"./install-b3d57d15.js";import"./install-95d77889.js";const h=U=>(he("data-v-ad53a986"),U=U(),xe(),U),Te={class:"flex-gap-8"},Ue={class:"flex-gap-16"},Ee=["onClick"],Me={slot:"label"},qe=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Be={style:{float:"left"}},Fe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},ze={class:"flex-gap-8"},Ge={slot:"label"},Re=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Le={slot:"label"},Pe=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),$e={slot:"label"},De=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Ne={slot:"label"},He=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Oe={slot:"label"},Ae=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Je={slot:"label"},Ke=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),je={slot:"label"},Qe=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),We={slot:"label"},Xe=h(()=>r("i",{class:"el-icon-info tips-icon"},null,-1)),Ye=pe({__name:"Index",setup(U){const{taskTypeList:Q,getTaskTypeName:W}=we(),H=_(),R=_([]),X=function(n,a){const u=n.indexOf(a);return u>-1?(n.splice(u,1),!0):!1},Y=async n=>{X(R.value,n.id)||R.value.push(n.id)},L=_();let o=_({name:"",version:0,exampleSetId:"",pretrainId:"",tagIds:[],tags:[],batchSize:4,numEpochs:10,lr:2e-4,samples_per_gpu:8,num_worker:4,max_epochs:30,ValSplit:.2});const Z=me({name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],exampleSetId:[{type:"string",required:!0,message:"请选择样本库",trigger:"change"}],batchSize:[{required:!0,message:"数据批处理大小",trigger:"change"},{type:"integer",min:1,message:"请输入大于0的整数，且为平台GPU数量的倍数"}],numEpochs:[{required:!0,message:"输入训练轮数",trigger:"change"},{type:"integer",min:1,message:"请输入大于0的整数"}],lr:[{required:!0,message:"输入学习率",trigger:"blur"},{type:"number",min:1e-6,message:"请输入大于0.000001的数字"}],samples_per_gpu:[{required:!0,message:"输入每个GPU训练的样本个数",trigger:"change"},{type:"integer",min:1,message:"请输入大于1的整数"}],num_worker:[{required:!0,message:"输入线程数量",trigger:"change"},{type:"integer",min:2,message:"请输入大于2的整数"}],max_epochs:[{required:!0,message:"输入训练轮数",trigger:"change"},{type:"integer",min:1,message:"请输入大于1的整数"}],ValSplit:[{required:!0,message:"输入测试集比例",trigger:"blur"},{type:"number",min:0,max:1,message:"请输入0-1中间的数字"}]}),E=_(""),k=_([]),ee=ce(()=>k.value.filter(n=>(!E.value||n.name.toLowerCase().includes(E.value.toLowerCase()))&&n.viaUpload==!1)),P=_(),O=_(),M=_(!1),m=_("");let q;_e(()=>{w(),q=new Ce().withAutomaticReconnect().withUrl(fe+"/TaskHub").build(),q.start().catch(n=>console.log("🚀 ~ file: Index.vue:166 ~ mounted ~ error:",n)),q.on("GetProgress",(n,a,u)=>{let S=k.value.find(x=>x.id==n);S.progress=u,S.status=a,(a==T.Success||a==T.Failed)&&w()})}),ge(()=>{q.off("GetProgress")});const $=_(.01),te=n=>{if(n=="")o.value.name="",$.value=.01,o.value.version=.01;else{let a=k.value.find(u=>u.id==n);o.value.name=a.name,o.value.version=a.version+.01,$.value=a.version+.01}},le=n=>{let a=P.value.find(u=>u.id==n);o.value.tags=a.tags,o.value.tagIds=a.tagIds},A=()=>{var n;m.value="",(n=L.value)==null||n.resetFields()},ae=n=>{m.value=n.name,C.get(`api/ExampleSet/GetForTrain/${m.value}`).then(a=>{P.value=a}),O.value=k.value.filter(a=>a.type===m.value&&a.status==T.Success)},w=()=>{C.get("api/Train/GetAll").then(n=>{n.forEach(a=>{a.progress=a.status===T.Success?100:0}),k.value=n})},oe=()=>{var n;(n=L.value)==null||n.validate(a=>{if(a){M.value=!1;let u={};m.value=="change"||m.value=="seg"?u={batchSize:o.value.batchSize,numEpochs:o.value.numEpochs,lr:o.value.lr}:u={samples_per_gpu:o.value.samples_per_gpu,num_worker:o.value.num_worker,max_epochs:o.value.max_epochs,lr:o.value.lr,ValSplit:o.value.ValSplit},C.post("api/train/create",{...o.value,type:m.value,params:JSON.stringify(u)}).then(()=>{w()})}})},ne=n=>{var a;(a=H.value)==null||a.toggleRowExpansion(n)},se=n=>{C.post("api/train/Stop/"+n.id).then(()=>{be({message:"任务终止成功",type:"success"}),w()})},re=n=>{C.post("api/train/delete/"+n.id).then(()=>{w()})};return(n,a)=>{const u=d("el-button"),S=d("el-input"),x=d("el-divider"),g=d("el-table-column"),J=d("el-popconfirm"),ie=d("el-table"),v=d("el-tooltip"),K=d("el-option"),j=d("el-select"),c=d("el-form-item"),p=d("el-col"),b=d("el-input-number"),I=d("el-row"),ue=d("el-form"),de=d("el-dialog");return f(),V(y,null,[e(ye,{title:"训练模型",icon:"icon-rengongshenjingwangluoxunlian"}),r("div",Te,[e(u,{type:"primary",onClick:a[0]||(a[0]=l=>M.value=!0)},{default:t(()=>[i("新建训练")]),_:1}),e(S,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=l=>E.value=l),modelModifiers:{trim:!0},style:{width:"300px"},placeholder:"请输入关键字搜索"},null,8,["modelValue"])]),e(x),e(ie,{data:ee.value,ref_key:"tableRef",ref:H,height:"calc(100vh - 223px)","row-key":l=>l.id,"expand-row-keys":R.value,onExpandChange:Y},{default:t(()=>[e(g,{type:"expand"},{default:t(l=>[e(ke,{task:l.row},null,8,["task"])]),_:1}),e(g,{type:"index",width:"50"}),e(g,{prop:"type",label:"任务类型"},{default:t(l=>[i(F(s(W)(l.row.type)),1)]),_:1}),e(g,{prop:"name",label:"名称"}),e(g,{prop:"version",label:"版本"}),e(g,{prop:"status",label:"状态",width:"180"},{default:t(l=>[e(Ie,{id:l.row.id,type:"train",status:l.row.status,progress:l.row.progress},null,8,["id","status","progress"])]),_:1}),e(g,{prop:"created",label:"开始时间",sortable:"",width:"160"}),e(g,{prop:"completed",label:"结束时间",sortable:"",width:"160"}),e(g,{width:"220","class-name":"hover-to-show"},{default:t(l=>[e(u,{type:"primary",link:"",onClick:B=>ne(l.row)},{default:t(()=>[i("详情")]),_:2},1032,["onClick"]),e(J,{width:"170","confirm-button-text":"终止","cancel-button-text":"取消",title:"确认终止此任务么?",onConfirm:B=>se(l.row)},{reference:t(()=>[e(u,{type:"warning",link:"",disabled:l.row.status>s(T).Running},{default:t(()=>[i("终止")]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm"]),e(J,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此任务么?",onConfirm:B=>re(l.row)},{reference:t(()=>[e(u,{type:"danger",link:""},{default:t(()=>[i("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","row-key","expand-row-keys"]),e(de,{title:"新建训练",modelValue:M.value,"onUpdate:modelValue":a[14]||(a[14]=l=>M.value=l),"close-on-click-modal":!1,onOpen:A,width:"750px"},{footer:t(()=>[D(r("div",null,[e(u,{onClick:A},{default:t(()=>[i("重新选择类型")]),_:1}),e(u,{type:"primary",onClick:oe},{default:t(()=>[i("提交")]),_:1})],512),[[N,m.value!=""]])]),default:t(()=>[D(r("div",null,[e(x,{"content-position":"left"},{default:t(()=>[i("请选择类型")]),_:1}),r("div",Ue,[(f(!0),V(y,null,z(s(Q),(l,B)=>(f(),V("div",{key:B,class:"train-type",onClick:Ze=>ae(l)},[r("i",{class:ve(["iconfont",l.icon])},null,2),r("div",null,F(l.title),1)],8,Ee))),128))])],512),[[N,m.value==""]]),D(e(ue,{model:s(o),rules:Z,ref_key:"trainFormRef",ref:L,"label-position":"top"},{default:t(()=>[e(x,{"content-position":"left"},{default:t(()=>[i("基本信息")]),_:1}),e(I,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(c,{label:"训练迭代",prop:"pretrainId"},{default:t(()=>[r("template",Me,[i(" 训练迭代 "),e(v,{class:"item",effect:"dark",content:"选择已有模型作为预训练模型，注意模型框架选择需与预训练模型所用框架保持一致。",placement:"top"},{default:t(()=>[qe]),_:1})]),e(j,{placeholder:"请选择训练结果",clearable:"",modelValue:s(o).pretrainId,"onUpdate:modelValue":a[2]||(a[2]=l=>s(o).pretrainId=l),style:{width:"100%"},onChange:te},{default:t(()=>[(f(!0),V(y,null,z(O.value,l=>(f(),G(K,{key:l.id,label:l.name,value:l.id},{default:t(()=>[r("span",Be,F(l.name),1),r("span",Fe,"v"+F(l.version),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"训练名称",prop:"name"},{default:t(()=>[e(S,{modelValue:s(o).name,"onUpdate:modelValue":a[3]||(a[3]=l=>s(o).name=l),modelModifiers:{trim:!0},placeholder:"请输入名称",disabled:s(o).pretrainId!=""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"版本",prop:"version"},{default:t(()=>[e(b,{modelValue:s(o).version,"onUpdate:modelValue":a[4]||(a[4]=l=>s(o).version=l),precision:2,step:.1,min:$.value,"controls-position":"right"},null,8,["modelValue","min"])]),_:1})]),_:1})]),_:1}),e(x,{"content-position":"left"},{default:t(()=>[i("样本信息")]),_:1}),e(I,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(c,{label:"样本库",prop:"exampleSetId"},{default:t(()=>[e(j,{placeholder:"请选择样本库",modelValue:s(o).exampleSetId,"onUpdate:modelValue":a[5]||(a[5]=l=>s(o).exampleSetId=l),style:{width:"300px"},onChange:le},{default:t(()=>[(f(!0),V(y,null,z(P.value,l=>(f(),G(K,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:16},{default:t(()=>[r("div",ze,[(f(!0),V(y,null,z(s(o).tags,l=>(f(),G(Se,{key:l.id,name:l.name,color:l.color},null,8,["name","color"]))),128))])]),_:1})]),_:1}),e(x,{"content-position":"left"},{default:t(()=>[i("训练参数")]),_:1}),m.value=="change"||m.value=="seg"?(f(),G(I,{key:0,gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(c,{label:"批处理大小",prop:"batchSize"},{default:t(()=>[r("template",Ge,[i(" 批处理大小 "),e(v,{class:"item",effect:"dark",content:"为一次网络需要学习的数据量，一般设置为显卡数量的整倍数，建议1-2倍。",placement:"top"},{default:t(()=>[Re]),_:1})]),e(b,{modelValue:s(o).batchSize,"onUpdate:modelValue":a[6]||(a[6]=l=>s(o).batchSize=l),modelModifiers:{number:!0},step:1,min:1},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"训练轮数",prop:"numEpochs"},{default:t(()=>[r("template",Le,[i(" 训练轮数 "),e(v,{class:"item",effect:"dark",content:"为一个完成的数据集通过神经网络一次并返回了一次，训练轮数越高，训练时间越长；训练样本量很大时可设置1-5，样本量小时可设置50-100。",placement:"top"},{default:t(()=>[Pe]),_:1})]),e(b,{modelValue:s(o).numEpochs,"onUpdate:modelValue":a[7]||(a[7]=l=>s(o).numEpochs=l),modelModifiers:{number:!0},step:1,min:1},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"学习率",prop:"lr"},{default:t(()=>[r("template",$e,[i(" 学习率 "),e(v,{class:"item",effect:"dark",content:"决定了模型训练中梯度下降的尺度，初始学习率一般设置为0.01；如有训练迭代，可适当降低。",placement:"top"},{default:t(()=>[De]),_:1})]),e(b,{modelValue:s(o).lr,"onUpdate:modelValue":a[8]||(a[8]=l=>s(o).lr=l),modelModifiers:{number:!0},step:1e-4,min:1e-6},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):(f(),V(y,{key:1},[e(I,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(c,{label:"每个GPU训练的样本个数",prop:"samples_per_gpu"},{default:t(()=>[r("template",Ne,[i(" 每个GPU训练的样本个数 "),e(v,{class:"item",effect:"dark",content:"等同于批处理大小，建议填写1-2。",placement:"top"},{default:t(()=>[He]),_:1})]),e(b,{modelValue:s(o).samples_per_gpu,"onUpdate:modelValue":a[9]||(a[9]=l=>s(o).samples_per_gpu=l),modelModifiers:{number:!0},step:1,min:1},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"线程数量",prop:"num_worker"},{default:t(()=>[r("template",Oe,[i(" 线程数量 "),e(v,{class:"item",effect:"dark",content:"推荐设置为批处理大小的2倍。",placement:"top"},{default:t(()=>[Ae]),_:1})]),e(b,{modelValue:s(o).num_worker,"onUpdate:modelValue":a[10]||(a[10]=l=>s(o).num_worker=l),modelModifiers:{number:!0},step:1,min:1},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"训练轮数",prop:"max_epochs"},{default:t(()=>[r("template",Je,[i(" 训练轮数 "),e(v,{class:"item",effect:"dark",content:"为一个完成的数据集通过神经网络一次并返回了一次，训练轮数越高，训练时间越长；训练样本量很大时可设置1-5，样本量小时可设置50-100。",placement:"top"},{default:t(()=>[Ke]),_:1})]),e(b,{modelValue:s(o).max_epochs,"onUpdate:modelValue":a[11]||(a[11]=l=>s(o).max_epochs=l),modelModifiers:{number:!0},step:1,min:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(p,{span:8},{default:t(()=>[e(c,{label:"学习率",prop:"lr"},{default:t(()=>[r("template",je,[i(" 学习率 "),e(v,{class:"item",effect:"dark",content:"决定了模型训练中梯度下降的尺度，初始学习率一般设置为0.01；如有训练迭代，可适当降低。",placement:"top"},{default:t(()=>[Qe]),_:1})]),e(b,{modelValue:s(o).lr,"onUpdate:modelValue":a[12]||(a[12]=l=>s(o).lr=l),modelModifiers:{number:!0},step:.01,min:1e-6},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(c,{label:"测试集比例",prop:"ValSplit"},{default:t(()=>[r("template",We,[i(" 测试集比例 "),e(v,{class:"item",effect:"dark",content:"即从训练样本里随机抽取的测试集的比例，一般设置0.2即可。",placement:"top"},{default:t(()=>[Xe]),_:1})]),e(b,{modelValue:s(o).ValSplit,"onUpdate:modelValue":a[13]||(a[13]=l=>s(o).ValSplit=l),modelModifiers:{number:!0},step:.1,min:0,max:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],64))]),_:1},8,["model","rules"]),[[N,m.value!=""]])]),_:1},8,["modelValue"])],64)}}});const dt=Ve(Ye,[["__scopeId","data-v-ad53a986"]]);export{dt as default};
