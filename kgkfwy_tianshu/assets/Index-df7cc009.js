import{d as oe,r as s,a as ne,D as se,H as re,I as ie,a9 as ue,l as f,c as n,e as g,h as e,f as _,w as l,F as T,o as m,i as c,t as P,g as r,J as E,K as B,q as L,G as de,m as z,E as U,_ as pe}from"./index-ab68adb5.js";import{B as ce}from"./BaseTitle-588acb84.js";import{T as me}from"./TaskInfo-d2a2e698.js";import{T as fe}from"./TaskProgress-8f20ffc2.js";import{u as _e,T as D}from"./useSetting-1e631b4e.js";import{H as ve}from"./HubConnectionBuilder-04baf802.js";import"./index.esm.min-90f1887f.js";import"./install-7ec1e6c2.js";import"./install-b3d57d15.js";import"./install-95d77889.js";const ge={class:"flex-gap-8"},we={class:"flex-gap-16"},be=["onClick"],he=oe({__name:"Index",setup(ye){const u=s(""),w=s(!1),{taskTypeList:J,getTaskTypeName:K}=_e(),C=s();let d=s({name:"",exampleSetId:"",trainId:""});const O=ne({name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],exampleSetId:[{required:!0,message:"请选择样本库",trigger:"change"}],trainId:[{required:!0,message:"请选择训练成果",trigger:"change"}]}),R=s(),b=s(""),V=s([]),j=se(()=>V.value.filter(o=>!b.value||o.name.toLowerCase().includes(b.value.toLowerCase())));let v;re(()=>{h(),X(),v=new ve().withAutomaticReconnect().withUrl(ie+"/TaskHub").build(),v.start().catch(o=>console.log("🚀 ~ file: Index.vue:152 ~ onMounted ~ error:",o)),v.on("GetProgress",(o,a,p)=>{let y=V.value.find(x=>x.id==o);y.progress=p})}),ue(()=>{v.off("GetProgress"),v.off("TestTaskCreated")});const F=s(),Q=o=>{u.value=o.name,f.get("/api/ExampleSet/GetForTrain/"+u.value).then(a=>{R.value=a}),F.value=$.value.filter(a=>a.type===u.value&&a.status==D.Success)},G=s(),W=o=>{var a;(a=G.value)==null||a.toggleRowExpansion(o)},M=()=>{var o;u.value="",(o=C.value)==null||o.resetFields()},$=s(),X=()=>{f.get("api/Train/GetAll").then(o=>{$.value=o})},h=()=>{f.get("api/Evaluate/GetAll").then(o=>{o.forEach(a=>{a.progress=a.status===D.Success?100:0}),V.value=o})},Y=()=>{var o;(o=C.value)==null||o.validate(a=>{a&&(w.value=!1,f.post("api/Evaluate/create",{...d.value,type:u.value}).then(()=>{U({type:"success",message:"新建成功"}),h()}))})},Z=o=>{f.post("api/Evaluate/Stop/"+o.id).then(()=>{U({message:"终止成功",type:"success"}),h()})},ee=o=>{f.post("api/Evaluate/delete/"+o.id).then(()=>{U({type:"success",message:"删除成功"}),h()})};return(o,a)=>{const p=n("el-button"),y=n("el-input"),x=n("el-divider"),i=n("el-table-column"),q=n("el-popconfirm"),te=n("el-table"),I=n("el-form-item"),S=n("el-col"),H=n("el-option"),N=n("el-select"),A=n("el-row"),le=n("el-form"),ae=n("el-dialog");return m(),g(T,null,[e(ce,{title:"测试模型",icon:"icon-lixianyunhang"}),_("div",ge,[e(p,{type:"primary",onClick:a[0]||(a[0]=t=>w.value=!0)},{default:l(()=>[c("新建测试")]),_:1}),e(y,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value=t),modelModifiers:{trim:!0},style:{width:"300px"},placeholder:"请输入关键字搜索"},null,8,["modelValue"])]),e(x),e(te,{data:j.value,ref_key:"tableRef",ref:G,height:"calc(100vh - 223px)"},{default:l(()=>[e(i,{type:"expand"},{default:l(t=>[e(me,{task:t.row},null,8,["task"])]),_:1}),e(i,{type:"index",width:"50"}),e(i,{prop:"type",label:"任务类型",width:"100"},{default:l(t=>[c(P(r(K)(t.row.type)),1)]),_:1}),e(i,{prop:"name",label:"名称","show-overflow-tooltip":""}),e(i,{prop:"desc",label:"描述","show-overflow-tooltip":""}),e(i,{prop:"status",label:"状态",width:"170"},{default:l(t=>[e(fe,{id:t.row.id,type:"eval",status:t.row.status,progress:t.row.progress},null,8,["id","status","progress"])]),_:1}),e(i,{prop:"created",label:"开始时间",sortable:"",width:"150"}),e(i,{prop:"completed",label:"结束时间",sortable:"",width:"150"}),e(i,{width:"220","class-name":"hover-to-show"},{default:l(t=>[e(p,{type:"primary",link:"",onClick:k=>W(t.row)},{default:l(()=>[c("详情")]),_:2},1032,["onClick"]),e(q,{width:"170","confirm-button-text":"终止","cancel-button-text":"取消",title:"确认终止此任务么?",onConfirm:k=>Z(t.row)},{reference:l(()=>[e(p,{type:"warning",link:"",disabled:t.row.status>r(D).Running},{default:l(()=>[c("终止")]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm"]),e(q,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此任务么?",onConfirm:k=>ee(t.row)},{reference:l(()=>[e(p,{type:"danger",link:""},{default:l(()=>[c("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(ae,{title:"新建测试",modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=t=>w.value=t),"close-on-click-modal":!1,onOpen:M,width:"750px"},{footer:l(()=>[E(_("div",null,[e(p,{onClick:M},{default:l(()=>[c("重新选择类型")]),_:1}),e(p,{type:"primary",onClick:Y},{default:l(()=>[c("提交")]),_:1})],512),[[B,u.value!=""]])]),default:l(()=>[E(_("div",null,[e(x,{"content-position":"left"},{default:l(()=>[c("请选择类型")]),_:1}),_("div",we,[(m(!0),g(T,null,L(r(J),(t,k)=>(m(),g("div",{key:k,class:"train-type",onClick:xe=>Q(t)},[_("i",{class:de(["iconfont",t.icon])},null,2),_("div",null,P(t.title),1)],8,be))),128))])],512),[[B,u.value==""]]),E(e(le,{model:r(d),rules:O,ref_key:"formRef",ref:C,"label-position":"top"},{default:l(()=>[e(A,{gutter:16},{default:l(()=>[e(S,{span:12},{default:l(()=>[e(I,{label:"测试名称",prop:"name"},{default:l(()=>[e(y,{modelValue:r(d).name,"onUpdate:modelValue":a[2]||(a[2]=t=>r(d).name=t),modelModifiers:{trim:!0},placeholder:"请输入名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:12},{default:l(()=>[e(I,{label:"训练成果",prop:"trainId"},{default:l(()=>[e(N,{placeholder:"请选择训练成果",modelValue:r(d).trainId,"onUpdate:modelValue":a[3]||(a[3]=t=>r(d).trainId=t),style:{width:"100%"}},{default:l(()=>[(m(!0),g(T,null,L(F.value,t=>(m(),z(H,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{gutter:16},{default:l(()=>[e(S,{span:12},{default:l(()=>[e(I,{label:"样本库",prop:"exampleSetId"},{default:l(()=>[e(N,{placeholder:"请选择样本库",modelValue:r(d).exampleSetId,"onUpdate:modelValue":a[4]||(a[4]=t=>r(d).exampleSetId=t),style:{width:"100%"}},{default:l(()=>[(m(!0),g(T,null,L(R.value,t=>(m(),z(H,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),[[B,u.value!=""]])]),_:1},8,["modelValue"])],64)}}});const De=pe(he,[["__scopeId","data-v-8fe5668a"]]);export{De as default};
