import{d as Q,a as ae,I as Re,r as I,c as n,o as _,e as P,h as e,w as t,i as V,m as L,z as H,J as te,K as le,f as v,t as W,F as K,l as A,E as M,_ as pe,q as oe,g as O,L as be,M as $e,H as ge,N as Fe,O as Se,P as _e,Q as ye,p as Ee,n as Oe,R as Ne,D as Me,S as Be,T as Le,U as Pe,V as je,W as Ae,X as ze,Y as Ye,Z as We,$ as Ge,A as he}from"./index-ab68adb5.js";import{_ as we}from"./picture-48-70f98f1e.js";import{B as xe}from"./BaseTreeSelect-895cd5e4.js";import{H as qe}from"./HubConnectionBuilder-04baf802.js";import{B as He}from"./BaseTitle-588acb84.js";import{M as Ke,V as Je,d as Xe,_ as Qe,a as Ze}from"./ImageInfo.vue_vue_type_script_setup_true_lang-abee9b6f.js";import{c as et}from"./map-6df5e062.js";import{C as tt}from"./CustomAttributes-f30ba1f9.js";import{M as lt}from"./MapView-15f162c8.js";import{_ as at}from"./folder-upload-48-6c4e3231.js";import{f as Ce}from"./format-aee67674.js";/* empty css           */const ot={class:"ConnectFolderLoading"},nt={class:"ConnectFolderLoading-title"},st=Q({__name:"ConnectData",emits:["success"],setup(z,{expose:U,emit:h}){const u=ae({totalCount:0,connectCount:0,progress:0});let w=new qe().withAutomaticReconnect().withUrl(Re+"/FolderHub").build();w.start().catch(r=>alert(r.message)),w.on("GetConnectFileCount",r=>{console.log("üöÄ ~ file: ConnectData.vue:45 ~ connection.on ~ fileCount:",r),u.totalCount=r,u.connectCount++,u.progress=u.connectCount/r*100});const x=I(!1),C=I();let D="";U({show:r=>{x.value=!0,D=r}});const p=(r,m)=>{let l=r.level==0?void 0:r.data.fullName;A.get("api/catalog/GetConnectFolderList",{params:{path:l}}).then(i=>(i.forEach(k=>{k.picture="folder-upload-48.png"}),m(i)))},d=I(!1),o=()=>{let r=C.value.getCheckedNodes()[0];r?(x.value=!1,d.value=!0,A.post("/api/catalog/ConnectFolder",{Path:r.fullName,ParentFolderId:D}).then(()=>{M({message:"ÂÖ≥ËÅîÊàêÂäü",type:"success"}),d.value=!1,u.progress=0,u.totalCount=0,u.connectCount=0,h("success")})):M("ËØ∑ÈÄâÊã©Êñá‰ª∂Â§π")};return(r,m)=>{const l=n("el-button"),i=n("el-dialog"),k=n("el-progress");return _(),P(K,null,[e(i,{title:"ÂÖ≥ËÅîÊñá‰ª∂Â§π",modelValue:x.value,"onUpdate:modelValue":m[1]||(m[1]=b=>x.value=b),"close-on-click-modal":!1,width:"500px"},{footer:t(()=>[e(l,{onClick:m[0]||(m[0]=b=>x.value=!1)},{default:t(()=>[V("ÂèñÊ∂à")]),_:1}),e(l,{type:"primary",onClick:o},{default:t(()=>[V("ÂÖ≥ËÅî")]),_:1})]),default:t(()=>[x.value?(_(),L(xe,{key:0,ref_key:"treeSelectRef",ref:C,"load-node":p},null,512)):H("",!0)]),_:1},8,["modelValue"]),te(v("div",ot,[e(k,{type:"circle","stroke-width":4,width:80,percentage:u.progress},{default:t(()=>[v("span",nt,W(u.connectCount)+"/"+W(u.totalCount),1)]),_:1},8,["percentage"])],512),[[le,d.value]])],64)}}});const rt=pe(st,[["__scopeId","data-v-f460d095"]]),it={style:{flex:"3","line-height":"32px"}},ut={key:1,style:{flex:"9"}},dt=Q({__name:"ImageFilter",emits:["change"],setup(z,{emit:U}){const h=I([{key:"OriginalResolution",label:"ÂàÜËæ®Áéá",valueType:"double"},{key:"Srid",label:"ÂùêÊ†áÁ≥ª",valueType:"string"},{key:"NumberOfBands",label:"Ê≥¢ÊÆµ",valueType:"int"},{key:"PixelDepth",label:"ÂÉèÁ¥†Ê∑±Â∫¶",valueType:"int"},{key:"FileType",label:"Êñá‰ª∂Á±ªÂûã",valueType:"string"},{key:"Multispectral",label:"Â§öÂÖâË∞±",valueType:"bool"},{key:"Created",label:"‰∏ä‰º†Êó•Êúü",valueType:"dateTime"},{key:"ImageDate",label:"ÂΩ±ÂÉèÊó•Êúü",valueType:"dateTime"}]),u=I([]),w=(p,d)=>{let o=h.value[p];o?(d.key=o.key,d.valueType=o.valueType,d.operator="=",d.value=null):(d.key=p,d.valueType="CustomAttributes",d.operator="=",d.value=null),g()},x=()=>{let p=0;u.value.push({operator:"=",key:h.value[p].key,keyIndex:p,parentOperator:"and",value:null,valueType:h.value[p].valueType})},C=p=>{var d=u.value.indexOf(p);d!==-1&&u.value.splice(d,1),g()},D=()=>{u.value=[],U("change")},g=()=>{let p=u.value.filter(d=>d.value!=null&&d.value!="");U("change",p)};return(p,d)=>{const o=n("el-alert"),r=n("el-button"),m=n("el-option"),l=n("el-select"),i=n("el-input"),k=n("el-input-number"),b=n("el-date-picker"),R=n("el-icon");return _(),P(K,null,[v("div",null,[e(o,{title:"ÈÄöËøáÊ∑ªÂä†Á≠õÈÄâÊù°‰ª∂ÔºåËøáÊª§Âá∫ÈúÄË¶ÅÊü•ÁúãÁöÑÊï∞ÊçÆ",type:"info",closable:!1,style:{"margin-bottom":"8px"}}),e(r,{type:"primary",plain:"",onClick:x},{default:t(()=>[V("Ê∑ªÂä†Êù°‰ª∂")]),_:1}),te(e(r,{onClick:D},{default:t(()=>[V("Ê∏ÖÁ©∫")]),_:1},512),[[le,u.value.length>0]])]),(_(!0),P(K,null,oe(u.value,(a,s)=>(_(),P("div",{class:"condition",key:s},[te(e(l,{modelValue:a.parentOperator,"onUpdate:modelValue":f=>a.parentOperator=f,style:{flex:"3"}},{default:t(()=>[e(m,{label:"‰∏î",value:"and"}),e(m,{label:"Êàñ",value:"or"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[le,s>0]]),te(v("label",it,"Êª°Ë∂≥",512),[[le,s==0]]),e(l,{modelValue:a.keyIndex,"onUpdate:modelValue":f=>a.keyIndex=f,filterable:"","allow-create":"",style:{flex:"6"},onChange:f=>w(f,a)},{default:t(()=>[(_(!0),P(K,null,oe(h.value,(f,$)=>(_(),L(m,{key:$,label:f.label,value:$},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e(l,{modelValue:a.operator,"onUpdate:modelValue":f=>a.operator=f,style:{flex:"4"},onChange:g},{default:t(()=>[e(m,{label:"ÊòØ",value:"="}),e(m,{label:"‰∏çÊòØ",value:"!="}),te(e(m,{label:"Â§ß‰∫é",value:">"},null,512),[[le,a.valueType!="string"&&a.valueType!="bool"]]),te(e(m,{label:"Â∞è‰∫é",value:"<"},null,512),[[le,a.valueType!="string"&&a.valueType!="bool"]])]),_:2},1032,["modelValue","onUpdate:modelValue"]),a.valueType=="string"||a.valueType=="CustomAttributes"?(_(),L(i,{key:0,placeholder:"ÂÄº",modelValue:a.value,"onUpdate:modelValue":f=>a.value=f,onChange:g,style:{flex:"9"}},null,8,["modelValue","onUpdate:modelValue"])):H("",!0),a.valueType=="int"||a.valueType=="double"?(_(),P("div",ut,[e(k,{modelValue:a.value,"onUpdate:modelValue":f=>a.value=f,"controls-position":"right",onChange:g,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])])):H("",!0),a.valueType=="dateTime"?(_(),L(b,{key:2,modelValue:a.value,"onUpdate:modelValue":f=>a.value=f,type:"date",placeholder:"ÈÄâÊã©Êó•Êúü",onChange:g,style:{flex:"9"}},null,8,["modelValue","onUpdate:modelValue"])):H("",!0),a.valueType=="bool"?(_(),L(l,{key:3,modelValue:a.value,"onUpdate:modelValue":f=>a.value=f,style:{flex:"9"},onChange:g},{default:t(()=>[e(m,{label:"ÊòØ",value:"true"}),e(m,{label:"Âê¶",value:"false"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):H("",!0),e(R,{style:{cursor:"pointer"},onClick:f=>C(a)},{default:t(()=>[e(O(be))]),_:2},1032,["onClick"])]))),128))],64)}}});const ct=pe(dt,[["__scopeId","data-v-419d8654"]]),pt={class:"map-dialog"},mt={class:"map-dialog-header"},ft={class:"map-dialog-title"},_t={id:"map",class:"map"},gt=Q({__name:"ImageView",props:{image:{type:Object,default:()=>{}}},emits:["rgbChange","close"],setup(z,{emit:U}){const h=z;let u=new Ke({view:new Je({projection:"EPSG:3857"}),controls:Xe({attribution:!1,rotate:!1,zoom:!1})});$e("map",u);let w;const x=I();ge(()=>{x.value={boundingBox:h.image.boundingBox,numberOfBands:h.image.numberOfBands,rgbBand:h.image.rgbBand},C(h.image.resolution)});const C=p=>{w=et(h.image.layerName,h.image.boundingBox,p),u.setTarget("map"),u.setLayers([w]),u.getView().fit(h.image.boundingBox)},D=p=>{let[d,o,r]=p;A.post(`api/Image/EditStyel?fileId=${h.image.id}&r=${d}&g=${o}&b=${r}`).then(()=>{w.getSource().refresh(),U("rgbChange",h.image,p)})},g=()=>{u.setTarget(void 0),u=void 0,U("close")};return(p,d)=>{const o=n("el-button"),r=n("el-popover");return _(),P("div",pt,[v("div",mt,[v("div",ft,[V(W(z.image.name)+" ",1),e(r,{placement:"bottom-start",trigger:"hover",width:"240"},{reference:t(()=>[e(o,{type:"primary",icon:O(Fe),link:""},null,8,["icon"])]),default:t(()=>[e(Qe,{image:z.image},null,8,["image"])]),_:1})]),e(o,{type:"primary",icon:O(Se),link:"",onClick:g,style:{"font-size":"20px"}},null,8,["icon"])]),v("div",_t,[e(Ze,{option:x.value,onRgbChange:D},null,8,["option"])])])}}});function vt(){return Math.random().toString(36).substring(2)}const ht=v("i",{class:"el-icon-upload"},null,-1),bt=v("div",{class:"el-upload__text"},[V("Â∞ÜÊñá‰ª∂ÊãñÂà∞Ê≠§Â§ÑÔºåÊàñ "),v("em",null,"ÁÇπÂáª‰∏ä‰º†")],-1),yt=Q({__name:"UploadSingleData",emits:["submitUpload"],setup(z,{expose:U,emit:h}){let u;const w=I(!1);U({show:a=>{var s;o.value=[],(s=g.value)==null||s.resetFields(),u=a,w.value=!0}});const C=I(),D=(a,s,f)=>{let $={folderId:u,name:s,fileId:null};a.field=="name"&&p.id!=null&&($.fileId=p.id),A.get("api/Image/CheckExistName",{params:$}).then(G=>G==!1?f(new Error("ÂêçÁß∞Â∑≤Â≠òÂú®")):f())},g=I(),p=ae({id:"",name:"",multispectral:!1,imageDate:"",desc:"",createCache:!1}),d=ae({name:[{required:!0,message:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",trigger:"blur"},{message:"ÂêçÁß∞Â∑≤Â≠òÂú®",validator:D,trigger:"blur"},{max:128,message:"ÂΩ±ÂÉèÂêçÁß∞ÈúÄÂ∞ë‰∫é 128 ‰∏™Â≠óÁ¨¶",trigger:"blur"}]}),o=I(),r=(a,s)=>{s.value=s},m=(a,s)=>{p.name=a.name.substr(0,a.name.lastIndexOf(".")),s.slice(0,s.length-1).find($=>$.name==a.name)&&(M.error("ÂΩìÂâçÊñá‰ª∂Â∑≤ÁªèÂ≠òÂú®"),s.pop()),s.value=s};let l;const i=a=>{l.append("files",a.file)},k=a=>{let s={};for(var f in a){if(s[a[f].name])return!0;s[a[f].name]=1}return!1},b=I(),R=async()=>{var s;let a=0;for(const f in o.value)if(Object.hasOwnProperty.call(o.value,f)){const $=o.value[f];a+=$.size}if(!(a/1024/1024<5&&await _e.confirm("‰∏ä‰º†Êñá‰ª∂ËøáÂ∞èÔºåÂèØËÉΩÊó†Ê≥ïÊª°Ë∂≥ËÆ≠ÁªÉÊàñËß£ËØëË¶ÅÊ±ÇÔºåÊòØÂê¶ÁªßÁª≠‰∏ä‰º†Ôºü","ÊèêÁ§∫",{showConfirmButton:!0,confirmButtonText:"ÁªßÁª≠",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then(()=>{}).catch(()=>!1)==!1)){if(o.value.length==0){M.error("ËØ∑ÈÄâÊã©Êñá‰ª∂");return}else if(o.value.length>1){if(k(o.value)){M.error("ÂåÖÂê´Áõ∏ÂêåÁöÑÊñá‰ª∂");return}let $=o.value.find(B=>B.name.substr(B.name.lastIndexOf(".")+1).toLowerCase()=="tif"||B.name.substr(B.name.lastIndexOf(".")+1).toLowerCase()=="tiff"||B.name.substr(B.name.lastIndexOf(".")+1).toLowerCase()=="img");if($==null){M.error("ËØ∑ÈÄâÊã©ÂΩ±ÂÉèÊñá‰ª∂");return}const G=$.name.substr($.name.lastIndexOf(".")+1).toLowerCase();if(G=="tif"||G=="tiff"){const B=["tif","hdr"];let y=[],F={};for(let T=0;T<o.value.length;T++){let ee=o.value[T].name.substr(0,o.value[T].name.lastIndexOf("."));F[ee]=1;let N=o.value[T].name.substr(o.value[T].name.lastIndexOf(".")+1).toLowerCase();if(y.push(N),!B.some(ne=>ne==N)){M.error("‰∏ä‰º†tifÊñá‰ª∂Êó∂ÔºåÂè™ÂèØ‰ª•‰∏ä‰º† .tif„ÄÅ.hdr Êñá‰ª∂");return}}if(!y.some(T=>T=="tif")){M.error("‰∏ä‰º†tifÊñá‰ª∂Êó∂ÔºåÂøÖÈ°ªÂåÖÂê´.tifÊñá‰ª∂");return}if(Object.keys(F).length>1){M.error("‰∏ä‰º†tifÊñá‰ª∂Êó∂Ôºå‰∏çÂêåÊ†ºÂºèÁöÑÊñá‰ª∂ÔºåÊñá‰ª∂ÂêçÁß∞ÈúÄÁõ∏Âêå");return}}else if(G=="tiff"){const B=["tiff","hdr"];let y=[],F={};for(let T=0;T<o.value.length;T++){let ee=o.value[T].name.substr(0,o.value[T].name.lastIndexOf("."));F[ee]=1;let N=o.value[T].name.substr(o.value[T].name.lastIndexOf(".")+1).toLowerCase();if(y.push(N),!B.some(ne=>ne==N)){M.error("‰∏ä‰º†tiffÊñá‰ª∂Êó∂ÔºåÂè™ÂèØ‰ª•‰∏ä‰º† .tiff„ÄÅ.hdr Êñá‰ª∂");return}}if(!y.some(T=>T=="tiff")){M.error("‰∏ä‰º†tiffÊñá‰ª∂Êó∂ÔºåÂøÖÈ°ªÂåÖÂê´ .tiff Êñá‰ª∂");return}if(Object.keys(F).length>1){M.error("‰∏ä‰º†tiffÊñá‰ª∂Êó∂Ôºå‰∏çÂêåÊ†ºÂºèÁöÑÊñá‰ª∂ÔºåÊñá‰ª∂ÂêçÁß∞ÈúÄÁõ∏Âêå");return}}else{const B=["img","ige"];let y=[],F={};for(let T=0;T<o.value.length;T++){let ee=o.value[T].name.substr(0,o.value[T].name.lastIndexOf("."));F[ee]=1;let N=o.value[T].name.substr(o.value[T].name.lastIndexOf(".")+1).toLowerCase();if(y.push(N),!B.some(ne=>ne==N)){M.error("‰∏ä‰º†imgÊñá‰ª∂Êó∂ÔºåÂè™ÂèØ‰ª•‰∏ä‰º† .img„ÄÅ.ige Êñá‰ª∂");return}}if(!y.some(T=>T=="img")){M.error("‰∏ä‰º†imgÊñá‰ª∂Êó∂ÔºåÂøÖÈ°ªÂåÖÂê´.imgÊñá‰ª∂");return}if(Object.keys(F).length>1){M.error("‰∏ä‰º†imgÊñá‰ª∂Êó∂Ôºå‰∏çÂêåÊ†ºÂºèÁöÑÊñá‰ª∂ÔºåÊñá‰ª∂ÂêçÁß∞ÈúÄÁõ∏Âêå");return}}}else if(o.value.length==1){let f=o.value[0].name.substr(o.value[0].name.lastIndexOf(".")+1).toLowerCase();if(f=="hdr"){if(o.value.length==1){M.error("‰∏çÂèØ‰ª•ÂçïÁã¨‰∏ä‰º†hdrÊñá‰ª∂ÔºåËØ∑ÂêåÊó∂‰∏ä‰º† .tif Êñá‰ª∂");return}}else if(f=="ige"&&o.value.length==1){M.error("‰∏çÂèØ‰ª•ÂçïÁã¨‰∏ä‰º†igeÊñá‰ª∂ÔºåËØ∑ÂêåÊó∂‰∏ä‰º† .img Êñá‰ª∂");return}}(s=g.value)==null||s.validate(f=>{if(f){l=new FormData,b.value.submit(),l.append("name",p.name),l.append("multispectral",p.multispectral),l.append("imageDate",p.imageDate),l.append("desc",p.desc),l.append("createCache",p.createCache);let $=C.value.getAttribute();$!=null&&l.append("customAttributes",JSON.stringify($)),u&&l.append("folderId",u),w.value=!1,h("submitUpload",l)}})}};return(a,s)=>{const f=n("el-input"),$=n("el-form-item"),G=n("el-date-picker"),B=n("el-col"),y=n("el-switch"),F=n("el-row"),Y=n("el-upload"),q=n("el-form"),T=n("el-button"),ee=n("el-dialog");return _(),L(ee,{title:"‰∏ä‰º†ÂΩ±ÂÉè",modelValue:w.value,"onUpdate:modelValue":s[8]||(s[8]=N=>w.value=N),"close-on-click-modal":!1,width:"700px"},{footer:t(()=>[e(T,{onClick:s[6]||(s[6]=N=>w.value=!1)},{default:t(()=>[V("ÂèñÊ∂à")]),_:1}),e(T,{type:"primary",onClick:s[7]||(s[7]=N=>R())},{default:t(()=>[V("Êèê‰∫§")]),_:1})]),default:t(()=>[e(q,{model:p,rules:d,ref_key:"formRef",ref:g,"label-position":"top"},{default:t(()=>[e($,{label:"ÂΩ±ÂÉèÂêçÁß∞",prop:"name"},{default:t(()=>[e(f,{placeholder:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",modelValue:p.name,"onUpdate:modelValue":s[0]||(s[0]=N=>p.name=N)},null,8,["modelValue"])]),_:1}),e(F,{gutter:16},{default:t(()=>[e(B,{span:12},{default:t(()=>[e($,{label:"ÂΩ±ÂÉèÊó•Êúü",prop:"imageDate"},{default:t(()=>[e(G,{type:"date",placeholder:"ËØ∑ÈÄâÊã©Êó•Êúü",modelValue:p.imageDate,"onUpdate:modelValue":s[1]||(s[1]=N=>p.imageDate=N),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:6},{default:t(()=>[e($,{label:"Â§öÂÖâË∞±",prop:"multispectral"},{default:t(()=>[e(y,{modelValue:p.multispectral,"onUpdate:modelValue":s[2]||(s[2]=N=>p.multispectral=N)},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:6},{default:t(()=>[e($,{label:"ÁîüÊàêÁºìÂ≠ò",prop:"createCache"},{default:t(()=>[e(y,{modelValue:p.createCache,"onUpdate:modelValue":s[3]||(s[3]=N=>p.createCache=N)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,{class:"image-upload",ref_key:"uploadRef",ref:b,drag:"",multiple:"","auto-upload":!1,"http-request":i,action:"/api/Image/UploadImageFile",accept:"image/tiff,.jpeg,.jpg,.png,.img,.ige,.hdr",data:p,"on-remove":r,"on-change":m,"file-list":o.value,"onUpdate:fileList":s[4]||(s[4]=N=>o.value=N),limit:2},{default:t(()=>[ht,bt]),_:1},8,["data","file-list"]),e($,{label:"Ëá™ÂÆö‰πâÂ±ûÊÄß"},{default:t(()=>[e(tt,{ref_key:"customAttributesRef",ref:C},null,512)]),_:1}),e($,{label:"Â§áÊ≥®",prop:"desc"},{default:t(()=>[e(f,{type:"textarea",placeholder:"ËØ∑ËæìÂÖ•Â§áÊ≥®",modelValue:p.desc,"onUpdate:modelValue":s[5]||(s[5]=N=>p.desc=N),maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),wt=z=>(Ee("data-v-ce709a35"),z=z(),Oe(),z),xt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},Ct={class:"upload-list-index"},kt={class:"upload-list"},It=wt(()=>v("i",{class:"el-icon-document"},null,-1)),Vt=Q({__name:"UploadMultipleData",emits:["submitUpload"],setup(z,{expose:U,emit:h}){const u=I(),w=ae({files:[]}),x=I(),C=I(!1);let D;U({show:l=>{var i;D=l,(i=x.value)==null||i.$el.querySelector("input").click()}});const p=(l,i,k)=>{console.log("üöÄ ~ file: UploadMultipleData.vue:91 ~ checkExistName ~ value:",i),A.get("api/Image/CheckExistName",{params:{folderId:D,name:i,fileId:null}}).then(b=>{b==!1?k(new Error("ÂêçÁß∞Â∑≤Â≠òÂú®")):k()})},d=l=>{let i=w.files.findIndex(k=>k==l);w.files.splice(i,1),w.files.length==0&&(C.value=!1)},o=l=>{let i=l.name.substr(0,l.name.lastIndexOf(".")),k=l.name.substr(l.name.lastIndexOf(".")+1).toLowerCase(),b=w.files.find(R=>R.files.some(a=>a.name.substr(0,l.name.lastIndexOf("."))==i));if(b==null||k=="png"||k=="jpg"||k=="jpeg")w.files.push({files:[l.raw],name:i,multispectral:!1,imageDate:"",desc:"",folderId:D});else{let R=b.files[0].name.substr(b.files[0].name.lastIndexOf(".")+1).toLowerCase();(R=="tif"||R=="hdr")&&(k=="tif"||k=="hdr")||(R=="tiff"||R=="hdr")&&(k=="tiff"||k=="hdr")||(R=="img"||R=="ige")&&(k=="img"||k=="ige")?b.files.push(l.raw):w.files.push({files:[l.raw],name:i,multispectral:!1,imageDate:"",desc:"",folderId:D})}C.value=!0},r=()=>{var l;w.files=[],(l=x.value)==null||l.clearFiles()},m=()=>{var l;(l=u.value)==null||l.validate(i=>{if(i){let k=!0;if(w.files.forEach(b=>{(b.name==null||b.name==null||b.name=="")&&(setTimeout(()=>{M.error("ÂΩ±ÂÉèÂêçÁß∞‰∏çÂèØ‰∏∫Á©∫")},10),k=!1);let R=0;b.files.forEach(s=>{R+=s.size}),R/1024/1024<5&&setTimeout(()=>{M({message:"‰∏ä‰º†Êñá‰ª∂ËøáÂ∞èÔºåÂèØËÉΩÊó†Ê≥ïÊª°Ë∂≥ËÆ≠ÁªÉÊàñËß£ËØëË¶ÅÊ±Ç",type:"warning"})},10);let a=[];b.files.forEach(s=>{let f=s.name.substr(s.name.lastIndexOf(".")+1).toLowerCase();a.push(f)}),a.includes("hdr")&&!a.includes("tif")&&(setTimeout(()=>{M.error("‰∏çÂèØÂçïÁã¨‰∏ä‰º†hdrÊñá‰ª∂")},10),k=!1),a.includes("ige")&&!a.includes("img")&&(setTimeout(()=>{M.error("‰∏çÂèØÂçïÁã¨‰∏ä‰º†igeÊñá‰ª∂")},10),k=!1)}),!k)return;w.files.forEach(b=>{let R=new FormData;b.files.forEach(a=>{R.append("files",a)}),R.append("name",b.name),R.append("multispectral",b.multispectral),R.append("imageDate",b.imageDate),R.append("desc",b.desc),b.folderId&&R.append("folderId",b.folderId),h("submitUpload",R)}),C.value=!1}})};return(l,i)=>{const k=n("el-upload"),b=n("el-button"),R=n("el-input"),a=n("el-form-item"),s=n("el-col"),f=n("el-date-picker"),$=n("el-switch"),G=n("el-row"),B=n("el-form"),y=n("el-dialog");return _(),P(K,null,[e(k,{ref_key:"multipleUploadRef",ref:x,accept:"image/tiff,.jpeg,.jpg,.png,.img,.ige,.hdr",multiple:"","auto-upload":!1,"show-file-list":!1,action:"","on-change":o,style:{display:"none"}},null,512),e(y,{title:"ÊâπÈáè‰∏ä‰º†",modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=F=>C.value=F),"close-on-click-modal":!1,width:"600px",onClosed:r},{footer:t(()=>[e(b,{onClick:i[0]||(i[0]=F=>C.value=!1)},{default:t(()=>[V("ÂèñÊ∂à")]),_:1}),e(b,{type:"primary",onClick:i[1]||(i[1]=F=>m())},{default:t(()=>[V("Êèê‰∫§")]),_:1})]),default:t(()=>[e(B,{model:w,ref_key:"multipleUploadFormRef",ref:u,"label-position":"top",style:{"max-height":"570px","overflow-y":"auto","overflow-x":"hidden"}},{default:t(()=>[(_(!0),P(K,null,oe(w.files,(F,Y)=>(_(),P("div",{key:Y},[v("div",null,[v("div",xt,[v("span",Ct,W(Y+1)+".",1),e(b,{icon:O(ye),link:"",onClick:q=>d(F)},null,8,["icon","onClick"])]),v("ul",kt,[(_(!0),P(K,null,oe(F.files,(q,T)=>(_(),P("li",{class:"upload-list__item",key:T},[It,V(" "+W(q.name),1)]))),128))])]),e(G,{gutter:8},{default:t(()=>[e(s,{span:10},{default:t(()=>[e(a,{label:"ÂΩ±ÂÉèÂêçÁß∞",prop:`files.${Y}.name`,rules:[{required:!0,message:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",trigger:"blur"},{message:"ÂêçÁß∞Â∑≤Â≠òÂú®",validator:p,trigger:"blur"},{max:128,message:"ÂΩ±ÂÉèÂêçÁß∞ÈúÄÂ∞ë‰∫é 128 ‰∏™Â≠óÁ¨¶",trigger:"blur"}]},{default:t(()=>[e(R,{placeholder:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",modelValue:F.name,"onUpdate:modelValue":q=>F.name=q},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1024),e(s,{span:10},{default:t(()=>[e(a,{label:"ÂΩ±ÂÉèÊó•Êúü",prop:"imageDate"},{default:t(()=>[e(f,{type:"date",placeholder:"ËØ∑ÈÄâÊã©Êó•Êúü",modelValue:F.imageDate,"onUpdate:modelValue":q=>F.imageDate=q,"value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(s,{span:4},{default:t(()=>[e(a,{label:"Â§öÂÖâË∞±",prop:"multispectral"},{default:t(()=>[e($,{modelValue:F.multispectral,"onUpdate:modelValue":q=>F.multispectral=q},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const Dt=pe(Vt,[["__scopeId","data-v-ce709a35"]]),Tt={class:"upload-status"},Ut={style:{"font-size":"14px"}},Rt={class:"flex-gap-8",style:{"align-items":"center"}},$t={style:{"font-size":"14px"}},Ft=Q({__name:"Upload",emits:["uploadSuccess"],setup(z,{expose:U,emit:h}){const u=I(),w=d=>{u.value.show(d)},x=I();U({uploadSingleData:w,uploadMultipleData:d=>{x.value.show(d)}});const D=ae([]),g=d=>{const o=Ne.CancelToken.source();let r=ae({fileId:vt(),fileName:d.get("name"),percentage:0,status:"",cancelTokenSource:o});D.push(r),A.post("/api/Image/UploadImageFile",d,{onUploadProgress:m=>{r.percentage=Math.floor(m.loaded*100/m.total)},cancelToken:o.token}).then(()=>{r.status="success",setTimeout(()=>{let m=D.findIndex(l=>l.fileId==r.fileId);D.splice(m,1),h("uploadSuccess")},2e3)}).catch(m=>{r.status="exception",m=="Cancel"?M({type:"info",message:"‰∏ä‰º†Â∑≤ÂèñÊ∂à"}):M.error("ÈîôËØØ"),setTimeout(()=>{let l=D.findIndex(i=>i.fileId==r.fileId);D.splice(l,1)},2e3)})},p=d=>{d.cancel()};return(d,o)=>{const r=n("el-button"),m=n("el-progress"),l=n("el-card");return _(),P(K,null,[D.length>0?(_(),L(l,{key:0,header:"‰∏ä‰º†‰ªªÂä°",class:"upload-list"},{default:t(()=>[(_(!0),P(K,null,oe(D,i=>(_(),P("div",{key:i.fileId,style:{"margin-bottom":"16px"}},[v("div",Tt,[v("span",Ut,W(i.fileName),1),v("div",Rt,[v("span",$t,W(i.percentage)+"%",1),e(r,{icon:O(ye),link:"",onClick:k=>p(i.cancelTokenSource)},null,8,["icon","onClick"])])]),e(m,{"stroke-width":4,percentage:i.percentage,status:i.status,"show-text":!1},null,8,["percentage","status"])]))),128))]),_:1})):H("",!0),e(yt,{ref_key:"uploadSingleDataRef",ref:u,onSubmitUpload:g},null,512),e(Dt,{ref_key:"uploadMultipleDataRef",ref:x,onSubmitUpload:g},null,512)],64)}}});const St=pe(Ft,[["__scopeId","data-v-7d6db5d4"]]),ke=Q({__name:"CustomAttributesInfo",props:{attributes:{type:String,default:null}},setup(z){const U=z,h=Me(()=>{if(U.attributes!=null){const u=JSON.parse(U.attributes);return Object.entries(u)}else return[]});return(u,w)=>{const x=n("el-descriptions-item"),C=n("el-descriptions");return _(),L(C,{column:1,size:"small",border:""},{default:t(()=>[(_(!0),P(K,null,oe(h.value,(D,g)=>(_(),L(x,{label:D[0],key:g},{default:t(()=>[V(W(D[1]),1)]),_:2},1032,["label"]))),128))]),_:1})}}}),Et={style:{display:"flex","justify-content":"space-between"}},Ot=v("i",{class:"el-breadcrumb__separator el-icon-arrow-right"},null,-1),Nt={class:"el-breadcrumb__inner",style:{"font-size":"14px"}},Mt={class:"directory"},Bt=v("img",{class:"directory_icon",src:at},null,-1),Lt=["onClick"],Pt={class:"directory"},jt=v("img",{class:"directory_icon",src:we},null,-1),At=["onClick"],zt=v("i",{class:"icon iconfont icon-shuxingbiao"},null,-1),Yt=v("i",{class:"el-icon-more",style:{color:"#409eff"}},null,-1),Wt=Q({__name:"DataCenterCatalog",emits:["imageClick"],setup(z,{emit:U}){const h=I("Province"),u=I([{name:"Ë°åÊîøÂå∫Âàí",value:"Province"},{name:"ÂàÜËæ®Áéá",value:"Resolution"}]),w=I(),x=I([]),C=I([]);ge(()=>{o()});const D=(l,i)=>{console.log("üöÄ ~ file: DataCenterCatalog.vue:133 ~ handleMoreCommand ~ command:",i)},g=(l,i)=>i.fileType===l,p=()=>{C.value=[]},d=()=>{C.value=[],x.value=[],o()},o=()=>{h.value=="Province"?A.get("/api/catalog/CatalogOfProvince").then(l=>{l.forEach(i=>{i.folderName=i.name}),x.value=l}):h.value=="Resolution"&&A.get("/api/catalog/CatalogOfResolution").then(l=>{l.forEach(i=>{i.folderName=i.maxResolution+"Á±≥ - "+i.minResolution+"Á±≥"}),x.value=l})},r=l=>{w.value=l.folderName,h.value=="Province"?A.get("api/catalog/GetImagesByProvince",{params:{gid:l.gid}}).then(i=>{C.value=i}):h.value=="Resolution"&&A.get("api/catalog/GetImagesByResolution",{params:{maxResolution:l.maxResolution,minResolution:l.minResolution}}).then(i=>{C.value=i})},m=l=>{U("imageClick",l)};return(l,i)=>{const k=n("el-button"),b=n("el-radio-button"),R=n("el-radio-group"),a=n("el-table-column"),s=n("el-table"),f=n("el-popover"),$=n("el-dropdown-item"),G=n("el-dropdown-menu"),B=n("el-dropdown");return _(),P(K,null,[v("div",Et,[v("div",null,[w.value?(_(),P(K,{key:0},[e(k,{type:"text",class:"el-breadcrumb__inner is-link",onClick:p},{default:t(()=>[V("ËøîÂõû")]),_:1}),Ot,v("span",Nt,W(w.value),1)],64)):H("",!0)]),e(R,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=y=>h.value=y),onChange:d},{default:t(()=>[(_(!0),P(K,null,oe(u.value,y=>(_(),L(b,{label:y.value,key:y.value},{default:t(()=>[V(W(y.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),te(e(s,{data:x.value,style:{width:"100%","margin-top":"16px"},height:"calc(100vh - 270px)"},{default:t(()=>[e(a,{label:"ÂêçÁß∞"},{default:t(y=>[v("div",Mt,[Bt,v("span",{class:"directory_name",onClick:F=>r(y.row)},W(y.row.folderName),9,Lt)])]),_:1}),e(a,{prop:"numberOfImages",label:"ÂΩ±ÂÉè‰∏™Êï∞"})]),_:1},8,["data"]),[[le,C.value.length==0]]),te(e(s,{data:C.value,"default-sort":{prop:"created",order:"descending"},style:{width:"100%","margin-top":"16px"},height:"calc(100vh - 270px)"},{default:t(()=>[e(a,{label:"Êñá‰ª∂ÂêçÁß∞","show-overflow-tooltip":""},{default:t(y=>[v("div",Pt,[jt,v("span",{class:"directory_name",onClick:F=>m(y.row)},W(y.row.name),9,At)])]),_:1}),e(a,{prop:"srid",label:"ÂùêÊ†áÁ≥ª"}),e(a,{label:"ÂàÜËæ®Áéá"},{default:t(y=>[V(W(y.row.unit=="degree"?Number(y.row.resolution).toFixed(2)+"m":Number(y.row.originalResolution).toFixed(2)+"m"),1)]),_:1}),e(a,{prop:"numberOfBands",label:"Ê≥¢ÊÆµ"}),e(a,{prop:"pixelDepth",label:"ÂÉèÁ¥†Ê∑±Â∫¶"}),e(a,{prop:"originalRasterXSize",label:"ÂΩ±ÂÉèÂÆΩÂ∫¶"}),e(a,{prop:"originalRasterYSize",label:"ÂΩ±ÂÉèÈ´òÂ∫¶"}),e(a,{prop:"customAttributes",label:"Â±ûÊÄß",align:"center",width:"100"},{default:t(y=>[y.row.customAttributes!=null?(_(),L(f,{key:0,placement:"right-start",width:"200",trigger:"hover"},{reference:t(()=>[zt]),default:t(()=>[(_(),L(ke,{attributes:y.row.customAttributes,key:y.row.id},null,8,["attributes"]))]),_:2},1024)):H("",!0)]),_:1}),e(a,{prop:"fileType",label:"Êñá‰ª∂Á±ªÂûã",filters:[{text:"GeoTIFF",value:"GeoTIFF"},{text:"ERDASImg",value:"ERDASImg"},{text:"WorldImage",value:"WorldImage"}],"filter-method":g}),e(a,{label:"Â§ßÂ∞è"},{default:t(y=>[V(W(O(Ce)(y.row.fileSize)),1)]),_:1}),e(a,{prop:"created",label:"Êó•Êúü",width:"150",sortable:"","show-overflow-tooltip":""}),e(a,{label:"",align:"center",width:"70"},{default:t(y=>[e(B,{onCommand:F=>D(y.row,F)},{default:t(()=>[Yt,e(G,null,{default:t(()=>[e($,{command:"download"},{default:t(()=>[V("‰∏ãËΩΩ")]),_:1}),e($,{command:"goToParentDirectory"},{default:t(()=>[V("ÊâÄÂú®ÁõÆÂΩï")]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"]),[[le,C.value.length>0]])],64)}}}),Gt=Q({__name:"MoveData",emits:["success"],setup(z,{expose:U,emit:h}){const u=I(!1),w=I();let x=[],C=[];U({show:(d,o)=>{u.value=!0,x=d,C=o}});const g=(d,o)=>{A.get("api/catalog/GetFolders",{params:{folderId:d.level==0?void 0:d.data.id,createWay:"upload"}}).then(r=>(r.forEach(m=>{m.picture="folder-upload-48.png"}),o(r)))},p=()=>{let d=w.value.getCheckedNodes()[0];d?A.post("/api/catalog/MoveTo",{FolderIds:x,ImageIds:C,ParentFolderId:d.id}).then(()=>{u.value=!1,M({message:"ÁßªÂä®ÊàêÂäü",type:"success"}),h("success")}):M("ËØ∑ÈÄâÊã©Êñá‰ª∂Â§π")};return(d,o)=>{const r=n("el-button"),m=n("el-dialog");return _(),L(m,{title:"ÁßªÂä®Âà∞Êñá‰ª∂Â§π",modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=l=>u.value=l),"close-on-click-modal":!1,width:"500px"},{footer:t(()=>[e(r,{onClick:o[0]||(o[0]=l=>u.value=!1)},{default:t(()=>[V("ÂèñÊ∂à")]),_:1}),e(r,{type:"primary",onClick:p},{default:t(()=>[V("ÁßªÂä®")]),_:1})]),default:t(()=>[u.value?(_(),L(xe,{key:0,ref_key:"treeSelectRef",ref:w,"load-node":g},null,512)):H("",!0)]),_:1},8,["modelValue"])}}}),qt=Q({__name:"EditData",emits:["success"],setup(z,{expose:U,emit:h}){const u=I(!1);let w;U({show:o=>{var r;(r=D.value)==null||r.resetFields(),g.id=o.id,g.name=o.name,g.desc=o.desc,g.multispectral=o.multispectral,g.imageDate=o.imageDate,u.value=!0}});const C=(o,r,m)=>{let l={folderId:w,name:r,fileId:null};o.field=="name"&&g.id!=null&&(l.fileId=g.id),A.get("api/Image/CheckExistName",{params:l}).then(i=>i==!1?m(new Error("ÂêçÁß∞Â∑≤Â≠òÂú®")):m())},D=I();let g=ae({id:"",name:"",multispectral:!1,imageDate:"",desc:""});const p=ae({name:[{required:!0,message:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",trigger:"blur"},{message:"ÂêçÁß∞Â∑≤Â≠òÂú®",validator:C,trigger:"blur"},{max:128,message:"ÂΩ±ÂÉèÂêçÁß∞ÈúÄÂ∞ë‰∫é 128 ‰∏™Â≠óÁ¨¶",trigger:"blur"}]}),d=()=>{var o;(o=D.value)==null||o.validate(r=>{r&&A.post("api/Image/Update",g).then(()=>{M({type:"success",message:"‰øÆÊîπÊàêÂäü"}),u.value=!1,h("success")})})};return(o,r)=>{const m=n("el-input"),l=n("el-form-item"),i=n("el-switch"),k=n("el-date-picker"),b=n("el-form"),R=n("el-button"),a=n("el-dialog");return _(),L(a,{title:"‰øÆÊîπÂΩ±ÂÉè",modelValue:u.value,"onUpdate:modelValue":r[6]||(r[6]=s=>u.value=s),"close-on-click-modal":!1,width:"600px"},{footer:t(()=>[e(R,{onClick:r[4]||(r[4]=s=>u.value=!1)},{default:t(()=>[V("ÂèñÊ∂à")]),_:1}),e(R,{type:"primary",onClick:r[5]||(r[5]=s=>d())},{default:t(()=>[V("Êèê‰∫§")]),_:1})]),default:t(()=>[e(b,{model:O(g),rules:p,ref_key:"formRef",ref:D,"label-position":"top"},{default:t(()=>[e(l,{label:"ÂΩ±ÂÉèÂêçÁß∞",prop:"name"},{default:t(()=>[e(m,{placeholder:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÂêçÁß∞",modelValue:O(g).name,"onUpdate:modelValue":r[0]||(r[0]=s=>O(g).name=s)},null,8,["modelValue"])]),_:1}),e(l,{label:"Â§öÂÖâË∞±",prop:"multispectral"},{default:t(()=>[e(i,{modelValue:O(g).multispectral,"onUpdate:modelValue":r[1]||(r[1]=s=>O(g).multispectral=s)},null,8,["modelValue"])]),_:1}),e(l,{label:"ÂΩ±ÂÉèÊó•Êúü",prop:"imageDate"},{default:t(()=>[e(k,{type:"date",placeholder:"ËØ∑ÈÄâÊã©Êó•Êúü",modelValue:O(g).imageDate,"onUpdate:modelValue":r[2]||(r[2]=s=>O(g).imageDate=s),"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(l,{label:"ÊèèËø∞",prop:"desc"},{default:t(()=>[e(m,{type:"textarea",placeholder:"ËØ∑ËæìÂÖ•ÂΩ±ÂÉèÊèèËø∞",modelValue:O(g).desc,"onUpdate:modelValue":r[3]||(r[3]=s=>O(g).desc=s),maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Ht={style:{display:"flex","justify-content":"space-between"}},Kt={class:"flex-gap-8"},Jt=v("i",{class:"iconfont icon-table"},null,-1),Xt=v("i",{class:"iconfont icon-category"},null,-1),Qt=v("i",{class:"iconfont icon-zaixianditu"},null,-1),Zt={key:0,class:"directory"},el=["src"],tl=["onClick"],ll={key:1,class:"directory"},al=v("img",{class:"directory_icon",src:we},null,-1),ol=["onMouseover","onClick"],nl=v("i",{class:"icon iconfont icon-shuxingbiao"},null,-1),hl=Q({__name:"Index",props:{folderId:{type:String},folderName:{type:String}},setup(z){const U=z,h=I("table"),u=I(""),w=()=>{};Be(()=>U.folderId,c=>{c=="SEARCHBYKEYWORD"||(Y(),a())});const x=I([]),C=I([]);ge(()=>{Y(),a()});const D=c=>{if(c.fileType!="Êñá‰ª∂Â§π")return c.unit=="degree"?Number(c.resolution).toFixed(2)+"m":Number(c.originalResolution).toFixed(2)+"m"},g=I(),p=c=>{c=="connect"&&g.value.show(U.folderId)},d=I(),o=()=>{d.value.uploadSingleData(U.folderId)},r=c=>{c=="multiple"&&d.value.uploadMultipleData(U.folderId)};let m=I([]);const l=c=>{m.value=c},i=I(),k=()=>{if(m.value.length>0){let c=m.value[0];c.fileType!="Êñá‰ª∂Â§π"?i.value.show({...c}):b(c)}},b=(c=null)=>{const S=c?"‰øÆÊîπÂêçÁß∞":"Êñ∞Âª∫Êñá‰ª∂Â§π";_e.prompt("",S,{confirmButtonText:"Êèê‰∫§",cancelButtonText:"ÂèñÊ∂à",inputPattern:/\S/,inputValue:c?c.name:null,inputPlaceholder:"ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞",inputErrorMessage:"ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞",inputValidator:j=>{if(j.indexOf(" ")!=-1)return"ÂêçÁß∞‰∏≠‰∏çÂèØÂê´ÊúâÁ©∫Ê†º";let J=j.length;return J<1?"ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞":J>50?"Êñá‰ª∂ÂêçÈïøÂ∫¶ÈúÄÂ∞ë‰∫é 50 ‰∏™Â≠óÁ¨¶":!0}}).then(({value:j})=>{let J=c?"api/catalog/UpdateFolder":"api/catalog/CreateFolder",se=c?{Name:j,Id:c.id}:{Name:j,ParentId:U.folderId};A.post(J,se).then(()=>{Y()})})},R=()=>{_e.confirm("Á°ÆËÆ§Âà†Èô§Êï∞ÊçÆ‰πà?","ÊèêÁ§∫",{showConfirmButton:!0,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then(()=>{let c=[],S=[];m.value.forEach(j=>{j.fileType=="Êñá‰ª∂Â§π"?c.push(j.id):S.push(j.id)}),A.post("/api/catalog/Delete",{FolderIds:c,ImageIds:S}).then(()=>{Y()})})},a=()=>{U.folderId==null?x.value=[]:A({method:"get",url:"api/catalog/GetDirectory",params:{id:U.folderId}}).then(c=>{x.value=c})},s=(c,S)=>S.fileType===c,f=c=>{c.thumbnail==null&&A.get(`/api/catalog/GetThumbnail/${c.id}`).then(S=>{c.thumbnail="data:image/png;base64,"+S})},$=c=>{he.push({name:"DataCenter",query:{folderId:c.id}})},G=I(!1),B=I(),y=c=>{B.value=c,G.value=!0},F=()=>{G.value=!1},Y=async()=>{let c=await A.get("/api/catalog/GetFolders",{params:{folderId:U.folderId}}),S=await A.get("/api/catalog/GetImagesInFolder",{params:{folderId:U.folderId}});C.value=[...c,...S]},q=c=>c.createWay=="preset"||x.value.length>0&&x.value[0].createWay=="connect"?!1:(x.value.length>0&&x.value[0].createWay=="preset",!0),T=(c,S)=>{S=="download"?A({method:"GET",url:"api/Image/Download/"+c.id,responseType:"blob"}).then(j=>{const J=j.data,se=new Blob([J]);let ue=j.headers["content-disposition"],me=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(ue),de=decodeURI(me[1]);const Z=document.createElement("a");Z.download=de,Z.target="_blank",Z.style.display="none",Z.href=URL.createObjectURL(se),document.body.appendChild(Z),Z.click(),URL.revokeObjectURL(Z.href),document.body.removeChild(Z)}):S=="goToParentDirectory"&&he.push({name:"datacenter",query:{folderId:c.folderId}})},ee=(c,S)=>{let j=C.value.find(J=>J.id==c);j.rgbBand=S},N=c=>{c?A.post("api/catalog/Filter",c).then(S=>{C.value=S}):Y()},ie=I(),ne=()=>{let c=[],S=[];m.value.forEach(j=>{j.createWay==null?S.push(j.id):c.push(j.id)}),ie.value.show(c,S)};return(c,S)=>{const j=n("el-icon"),J=n("el-dropdown-item"),se=n("el-dropdown-menu"),ue=n("el-dropdown"),re=n("el-button"),me=n("el-button-group"),de=n("el-popover"),Z=n("el-input"),fe=n("el-radio-button"),Ie=n("el-radio-group"),Ve=n("el-divider"),ve=n("el-breadcrumb-item"),De=n("el-breadcrumb"),X=n("el-table-column"),Te=n("el-image"),Ue=n("el-table");return _(),P(K,null,[e(He,{title:"ÂΩ±ÂÉè‰∏≠ÂøÉ",icon:"icon-yaogancehui"}),v("div",Ht,[v("div",Kt,[e(ue,{"split-button":"",type:"primary",onCommand:p,onClick:S[0]||(S[0]=E=>b())},{dropdown:t(()=>[e(se,null,{default:t(()=>[e(J,{command:"connect"},{default:t(()=>[V("ÂÖ≥ËÅîÊñá‰ª∂Â§π")]),_:1})]),_:1})]),default:t(()=>[e(j,{class:"el-icon--left"},{default:t(()=>[e(O(Pe))]),_:1}),V(" Êñ∞Âª∫Êñá‰ª∂Â§π ")]),_:1}),e(ue,{"split-button":"",type:"primary",onCommand:r,onClick:o},{dropdown:t(()=>[e(se,null,{default:t(()=>[e(J,{command:"multiple"},{default:t(()=>[V("ÊâπÈáè‰∏ä‰º†")]),_:1})]),_:1})]),default:t(()=>[e(j,{class:"el-icon--left"},{default:t(()=>[e(O(je))]),_:1}),V(" ‰∏ä‰º†ÂΩ±ÂÉè ")]),_:1}),e(me,null,{default:t(()=>[e(re,{type:"primary",icon:O(Ae),plain:"",onClick:k,disabled:O(m).length!=1},{default:t(()=>[V("ÁºñËæë")]),_:1},8,["icon","disabled"]),e(re,{type:"primary",icon:O(ze),plain:"",onClick:ne,disabled:O(m).length==0},{default:t(()=>[V("ÁßªÂä®")]),_:1},8,["icon","disabled"]),e(re,{type:"primary",icon:O(be),plain:"",onClick:R,disabled:O(m).length==0},{default:t(()=>[V("Âà†Èô§")]),_:1},8,["icon","disabled"])]),_:1}),e(de,{placement:"bottom",width:"600",trigger:"click"},{reference:t(()=>[e(re,{type:"primary",icon:O(Ye),plain:""},{default:t(()=>[V("Á≠õÈÄâ")]),_:1},8,["icon"])]),default:t(()=>[e(ct,{onChange:N})]),_:1}),e(Z,{placeholder:"ÊêúÁ¥¢Êï∞ÊçÆ‰∏≠ÂøÉ",modelValue:u.value,"onUpdate:modelValue":S[1]||(S[1]=E=>u.value=E),modelModifiers:{trim:!0},clearable:"",style:{width:"230px"}},{append:t(()=>[e(re,{icon:O(We),onClick:w},null,8,["icon"])]),_:1},8,["modelValue"])]),e(Ie,{modelValue:h.value,"onUpdate:modelValue":S[2]||(S[2]=E=>h.value=E)},{default:t(()=>[e(fe,{label:"table"},{default:t(()=>[Jt]),_:1}),e(fe,{label:"catalog"},{default:t(()=>[Xt]),_:1}),e(fe,{label:"map"},{default:t(()=>[Qt]),_:1})]),_:1},8,["modelValue"])]),e(Ve),te(v("div",null,[e(De,{"separator-class":"el-icon-arrow-right"},{default:t(()=>[e(ve,{to:{path:"/datacenter"}},{default:t(()=>[V("ÊàëÁöÑÊï∞ÊçÆ")]),_:1}),(_(!0),P(K,null,oe(x.value,E=>(_(),L(ve,{key:E.id,to:{path:"/datacenter",query:{folderId:E.id,folderName:E.name}}},{default:t(()=>[V(W(E.name),1)]),_:2},1032,["to"]))),128))]),_:1}),e(Ue,{data:C.value,style:{"margin-top":"16px"},height:"calc(100vh - 270px)",onSelectionChange:l},{default:t(()=>[e(X,{type:"selection",selectable:q}),e(X,{label:"Êñá‰ª∂ÂêçÁß∞","show-overflow-tooltip":""},{default:t(E=>[E.row.fileType=="Êñá‰ª∂Â§π"?(_(),P("div",Zt,[v("img",{class:"directory_icon",src:`/images/folder-${E.row.createWay}-48.png`},null,8,el),v("span",{class:"directory_name",onClick:ce=>$(E.row)},W(E.row.name),9,tl)])):(_(),P("div",ll,[al,e(de,{placement:"right-start",trigger:"hover","close-delay":0},{reference:t(()=>[v("span",{onMouseover:ce=>f(E.row),class:"directory_name",onClick:ce=>y(E.row)},W(E.row.name),41,ol)]),default:t(()=>[e(Te,{src:E.row.thumbnail,fit:"cover",style:{"max-width":"240px"}},null,8,["src"])]),_:2},1024)]))]),_:1}),e(X,{prop:"srid",label:"ÂùêÊ†áÁ≥ª",width:"70"}),e(X,{label:"ÂàÜËæ®Áéá",formatter:D}),e(X,{prop:"numberOfBands",label:"Ê≥¢ÊÆµ",width:"55"}),e(X,{prop:"pixelDepth",label:"ÂÉèÁ¥†Ê∑±Â∫¶",width:"80"}),e(X,{prop:"originalRasterXSize",label:"ÂΩ±ÂÉèÂÆΩÂ∫¶"}),e(X,{prop:"originalRasterYSize",label:"ÂΩ±ÂÉèÈ´òÂ∫¶"}),e(X,{prop:"customAttributes",label:"Ëá™ÂÆö‰πâÂ±ûÊÄß",align:"center",width:"95"},{default:t(E=>[E.row.customAttributes!=null?(_(),L(de,{key:0,placement:"right-start",width:"200",trigger:"hover"},{reference:t(()=>[nl]),default:t(()=>[(_(),L(ke,{attributes:E.row.customAttributes,key:E.row.id},null,8,["attributes"]))]),_:2},1024)):H("",!0)]),_:1}),e(X,{prop:"fileType",label:"Á±ªÂûã",filters:[{text:"GeoTIFF",value:"GeoTIFF"},{text:"ERDASImg",value:"ERDASImg"},{text:"WorldImage",value:"WorldImage"},{text:"Êñá‰ª∂Â§π",value:"Êñá‰ª∂Â§π"}],"filter-method":s,width:"90"}),e(X,{label:"Â§ßÂ∞è",sortable:"",align:"right","sort-by":"fileSize",width:"90"},{default:t(E=>[V(W(O(Ce)(E.row.fileSize)),1)]),_:1}),e(X,{prop:"created",label:"Êó•Êúü",width:"140",sortable:"","show-overflow-tooltip":""}),e(X,{label:"",align:"center",width:"70"},{default:t(E=>[E.row.fileType!="Êñá‰ª∂Â§π"?(_(),L(ue,{key:0,size:"medium",onCommand:ce=>T(E.row,ce)},{dropdown:t(()=>[e(se,null,{default:t(()=>[e(J,{command:"download"},{default:t(()=>[V("‰∏ãËΩΩ")]),_:1}),z.folderId=="SEARCHBYKEYWORD"?(_(),L(J,{key:0,command:"goToParentDirectory"},{default:t(()=>[V("ÊâÄÂú®ÁõÆÂΩï")]),_:1})):H("",!0)]),_:1})]),default:t(()=>[e(j,{class:"el-icon--left"},{default:t(()=>[e(O(Ge))]),_:1})]),_:2},1032,["onCommand"])):H("",!0)]),_:1})]),_:1},8,["data"])],512),[[le,h.value=="table"]]),h.value=="map"?(_(),L(lt,{key:0,toolbar:!0,onImageClick:y,style:{height:"calc(100vh - 240px)"}})):H("",!0),h.value=="catalog"?(_(),L(Wt,{key:1,onImageClick:y,style:{height:"calc(100vh - 240px)"}})):H("",!0),e(St,{ref_key:"uploadRef",ref:d,onUploadSuccess:Y},null,512),e(qt,{ref_key:"editDataRef",ref:i,onSuccess:Y},null,512),e(Gt,{ref_key:"moveDataRef",ref:ie,onSuccess:Y},null,512),e(rt,{ref_key:"connectDataRef",ref:g,onSuccess:Y},null,512),e(Le,{name:"el-fade-in-linear"},{default:t(()=>[G.value?(_(),L(gt,{key:0,image:B.value,onRgbUpdate:ee,onClose:F},null,8,["image"])):H("",!0)]),_:1})],64)}}});export{hl as default};
