import{aQ as q,b7 as b,b8 as J,b9 as Q,ba as ee,bb as te,bc as L,bd as ie,g as k,K as I,L as se,be as re,X as ne,ab as oe,bf as ae,m as le,bg as he,ah as ue,P as de,a8 as ce,ae as fe,af as xe,ag as ge,ac as Fe,bh as Z,ao as F,ap as v,bi as we,bj as ye,bk as pe,e as Te,c as $,bl as me,bm as _e,R as D,bn as Se,h as G,z as Ce,x as O,bo as Y,t as Pe,bp as Ee,bq as Ve,br as Me,bs as ve,T as De,bt as Ge,bu as j,l as z,w as Re,J as ke,aw as Be}from"./ImageInfo.vue_vue_type_script_setup_true_lang-abee9b6f.js";import{ai as Le,u as Ie}from"./index-ab68adb5.js";var B={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */B.read=function(t,e,i,s,r){var n,o,h=r*8-s-1,u=(1<<h)-1,l=u>>1,a=-7,d=i?r-1:0,c=i?-1:1,g=t[e+d];for(d+=c,n=g&(1<<-a)-1,g>>=-a,a+=h;a>0;n=n*256+t[e+d],d+=c,a-=8);for(o=n&(1<<-a)-1,n>>=-a,a+=s;a>0;o=o*256+t[e+d],d+=c,a-=8);if(n===0)n=1-l;else{if(n===u)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,s),n=n-l}return(g?-1:1)*o*Math.pow(2,n-s)};B.write=function(t,e,i,s,r,n){var o,h,u,l=n*8-r-1,a=(1<<l)-1,d=a>>1,c=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=s?0:n-1,f=s?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,o=a):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+d>=1?e+=c/u:e+=c*Math.pow(2,1-d),e*u>=2&&(o++,u/=2),o+d>=a?(h=0,o=a):o+d>=1?(h=(e*u-1)*Math.pow(2,r),o=o+d):(h=e*Math.pow(2,d-1)*Math.pow(2,r),o=0));r>=8;t[i+g]=h&255,g+=f,h/=256,r-=8);for(o=o<<r|h,l+=r;l>0;t[i+g]=o&255,g+=f,o/=256,l-=8);t[i+g-f]|=w*128};var Oe=x,P=B;function x(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}x.Varint=0;x.Fixed64=1;x.Bytes=2;x.Fixed32=5;var R=65536*65536,K=1/R,je=12,H=typeof TextDecoder>"u"?null:new TextDecoder("utf8");x.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),r=s>>3,n=this.pos;this.type=s&7,t(r,e,this),this.pos===n&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=E(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=U(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=E(this.buf,this.pos)+E(this.buf,this.pos+4)*R;return this.pos+=8,t},readSFixed64:function(){var t=E(this.buf,this.pos)+U(this.buf,this.pos+4)*R;return this.pos+=8,t},readFloat:function(){var t=P.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=P.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,s;return s=e[this.pos++],i=s&127,s<128||(s=e[this.pos++],i|=(s&127)<<7,s<128)||(s=e[this.pos++],i|=(s&127)<<14,s<128)||(s=e[this.pos++],i|=(s&127)<<21,s<128)?i:(s=e[this.pos],i|=(s&15)<<28,ze(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=je&&H?Qe(this.buf,e,t):Je(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==x.Bytes)return t.push(this.readVarint(e));var i=y(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==x.Bytes)return t.push(this.readSVarint());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==x.Bytes)return t.push(this.readBoolean());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==x.Bytes)return t.push(this.readFloat());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==x.Bytes)return t.push(this.readDouble());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==x.Bytes)return t.push(this.readFixed32());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==x.Bytes)return t.push(this.readSFixed32());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==x.Bytes)return t.push(this.readFixed64());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==x.Bytes)return t.push(this.readSFixed64());var e=y(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===x.Varint)for(;this.buf[this.pos++]>127;);else if(e===x.Bytes)this.pos=this.readVarint()+this.pos;else if(e===x.Fixed32)this.pos+=4;else if(e===x.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,t&-1,this.pos),_(this.buf,Math.floor(t*K),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,t&-1,this.pos),_(this.buf,Math.floor(t*K),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){Ke(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=et(this.buf,t,this.pos);var i=this.pos-e;i>=128&&N(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),P.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),P.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var s=this.pos-i;s>=128&&N(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,i){this.writeTag(t,x.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ae,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Xe,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,$e,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,We,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ze,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ye,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,He,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,qe,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,be,e)},writeBytesField:function(t,e){this.writeTag(t,x.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,x.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,x.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,x.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,x.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,x.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,x.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,x.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,x.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,x.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function ze(t,e,i){var s=i.buf,r,n;if(n=s[i.pos++],r=(n&112)>>4,n<128||(n=s[i.pos++],r|=(n&127)<<3,n<128)||(n=s[i.pos++],r|=(n&127)<<10,n<128)||(n=s[i.pos++],r|=(n&127)<<17,n<128)||(n=s[i.pos++],r|=(n&127)<<24,n<128)||(n=s[i.pos++],r|=(n&1)<<31,n<128))return m(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function y(t){return t.type===x.Bytes?t.readVarint()+t.pos:t.pos+1}function m(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function Ke(t,e){var i,s;if(t>=0?(i=t%4294967296|0,s=t/4294967296|0):(i=~(-t%4294967296),s=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,s=s+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Ne(i,s,e),Ue(s,e)}function Ne(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function Ue(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function N(t,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(s);for(var r=i.pos-1;r>=t;r--)i.buf[r+s]=i.buf[r]}function Ae(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Xe(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function We(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Ze(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function $e(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Ye(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function He(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function qe(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function be(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function E(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function _(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function U(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Je(t,e,i){for(var s="",r=e;r<i;){var n=t[r],o=null,h=n>239?4:n>223?3:n>191?2:1;if(r+h>i)break;var u,l,a;h===1?n<128&&(o=n):h===2?(u=t[r+1],(u&192)===128&&(o=(n&31)<<6|u&63,o<=127&&(o=null))):h===3?(u=t[r+1],l=t[r+2],(u&192)===128&&(l&192)===128&&(o=(n&15)<<12|(u&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):h===4&&(u=t[r+1],l=t[r+2],a=t[r+3],(u&192)===128&&(l&192)===128&&(a&192)===128&&(o=(n&15)<<18|(u&63)<<12|(l&63)<<6|a&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,h=1):o>65535&&(o-=65536,s+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),s+=String.fromCharCode(o),r+=h}return s}function Qe(t,e,i){return H.decode(t.subarray(e,i))}function et(t,e,i){for(var s=0,r,n;s<e.length;s++){if(r=e.charCodeAt(s),r>55295&&r<57344)if(n)if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}else r=n-55296<<10|r-56320|65536,n=null;else{r>56319||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=r&63|128)}return i}const tt=Le(Oe),A=ne();class C{constructor(e,i,s,r,n){this.styleFunction,this.extent_,this.id_=n,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s,this.properties_=r}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?q(this.flatCoordinates_):b(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=J(this.getExtent());this.flatInteriorPoints_=Q(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=ee(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=te(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=L(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let i=0;const s=this.ends_;for(let r=0,n=s.length;r<n;++r){const o=s[r],h=L(e,i,o,2,.5);ie(this.flatMidpoints_,h),i=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,i){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=k(e);const i=e.getExtent(),s=e.getWorldExtent();if(i&&s){const r=I(s)/I(i);se(A,s[0],s[3],r,-r,0,0,0),re(this.flatCoordinates_,0,this.flatCoordinates_.length,2,A,this.flatCoordinates_)}}getEnds(){return this.ends_}}C.prototype.getEndss=C.prototype.getEnds;C.prototype.getFlatCoordinates=C.prototype.getOrientedFlatCoordinates;const X=C;class it extends oe{constructor(e){super(),e=e||{},this.dataProjection=new ae({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:X,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,i,s,r){e.pos=i.geometry;const n=e.readVarint()+e.pos;let o=1,h=0,u=0,l=0,a=0,d=0;for(;e.pos<n;){if(!h){const c=e.readVarint();o=c&7,h=c>>3}h--,o===1||o===2?(u+=e.readSVarint(),l+=e.readSVarint(),o===1&&a>d&&(r.push(a),d=a),s.push(u,l),a+=2):o===7?a>d&&(s.push(s[d],s[d+1]),a+=2):le(!1,59)}a>d&&(r.push(a),d=a)}createFeature_(e,i,s){const r=i.type;if(r===0)return null;let n;const o=i.properties;let h;this.idProperty_?(h=o[this.idProperty_],delete o[this.idProperty_]):h=i.id,o[this.layerName_]=i.layer.name;const u=[],l=[];this.readRawGeometry_(e,i,u,l);const a=at(r,l.length);if(this.featureClass_===X)n=new this.featureClass_(a,u,l,o,h),n.transform(s.dataProjection);else{let d;if(a=="Polygon"){const f=he(u,l);d=f.length>1?new ue(u,"XY",f):new de(u,"XY",l)}else d=a==="Point"?new ce(u,"XY"):a==="LineString"?new fe(u,"XY"):a==="MultiPoint"?new xe(u,"XY"):a==="MultiLineString"?new ge(u,"XY",l):null;const c=this.featureClass_;n=new c,this.geometryName_&&n.setGeometryName(this.geometryName_);const g=Fe(d,!1,s);n.setGeometry(g),h!==void 0&&n.setId(h),n.setProperties(o,!0)}return n}getType(){return"arraybuffer"}readFeatures(e,i){const s=this.layers_;i=this.adaptOptions(i);const r=k(i.dataProjection);r.setWorldExtent(i.extent),i.dataProjection=r;const n=new tt(e),o=n.readFields(st,{}),h=[];for(const u in o){if(s&&!s.includes(u))continue;const l=o[u],a=l?[0,0,l.extent,l.extent]:null;r.setExtent(a);for(let d=0,c=l.length;d<c;++d){const g=ot(n,l,d),f=this.createFeature_(n,g,i);f!==null&&h.push(f)}}return h}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function st(t,e,i){if(t===3){const s={keys:[],values:[],features:[]},r=i.readVarint()+i.pos;i.readFields(rt,s,r),s.length=s.features.length,s.length&&(e[s.name]=s)}}function rt(t,e,i){if(t===15)e.version=i.readVarint();else if(t===1)e.name=i.readString();else if(t===5)e.extent=i.readVarint();else if(t===2)e.features.push(i.pos);else if(t===3)e.keys.push(i.readString());else if(t===4){let s=null;const r=i.readVarint()+i.pos;for(;i.pos<r;)t=i.readVarint()>>3,s=t===1?i.readString():t===2?i.readFloat():t===3?i.readDouble():t===4?i.readVarint64():t===5?i.readVarint():t===6?i.readSVarint():t===7?i.readBoolean():null;e.values.push(s)}}function nt(t,e,i){if(t==1)e.id=i.readVarint();else if(t==2){const s=i.readVarint()+i.pos;for(;i.pos<s;){const r=e.layer.keys[i.readVarint()],n=e.layer.values[i.readVarint()];e.properties[r]=n}}else t==3?e.type=i.readVarint():t==4&&(e.geometry=i.pos)}function ot(t,e,i){t.pos=e.features[i];const s=t.readVarint()+t.pos,r={layer:e,type:0,properties:{}};return t.readFields(nt,r,s),r}function at(t,e){let i;return t===1?i=e===1?"Point":"MultiPoint":t===2?i=e===1?"LineString":"MultiLineString":t===3&&(i="Polygon"),i}const lt=it;let ht=class extends Z{constructor(e,i,s,r,n,o){super(e,i,o),this.extent=null,this.format_=r,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=n,this.url_=s,this.key=s}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==F.IDLE&&(this.setState(F.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,i){this.setFeatures(e)}onError(){this.setState(F.ERROR)}setFeatures(e){this.features_=e,this.setState(F.LOADED)}setLoader(e){this.loader_=e}};const ut=ht,W=[];class dt extends Z{constructor(e,i,s,r){super(e,i,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=s}getContext(e){const i=v(e);return i in this.context_||(this.context_[i]=we(1,1,W)),this.context_[i]}hasContext(e){return v(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const i=v(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const i=this.context_[e];ye(i),W.push(i.canvas),delete this.context_[e]}super.release()}}const ct=dt;class ft extends pe{constructor(e){const i=e.projection||"EPSG:3857",s=e.extent||Te(i),r=e.tileGrid||$({extent:s,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:i,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:gt,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new me(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:ut,this.tileGrids_={}}getFeaturesInExtent(e){const i=[],s=this.tileCache;if(s.getCount()===0)return i;const r=_e(s.peekFirstKey())[0],n=this.tileGrid;return s.forEach(function(o){if(o.tileCoord[0]!==r||o.getState()!==F.LOADED)return;const h=o.getSourceTiles();for(let u=0,l=h.length;u<l;++u){const a=h[u],d=a.tileCoord;if(D(e,n.getTileCoordExtent(d))){const c=a.getFeatures();if(c)for(let g=0,f=c.length;g<f;++g){const w=c[g],p=w.getGeometry();D(e,p.getExtent())&&i.push(w)}}}}),i}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,i){const s=this.getTileCacheForProjection(e),r=Object.keys(i).reduce((n,o)=>{const h=Se(o),u=s.peek(h);if(u){const l=u.sourceTiles;for(let a=0,d=l.length;a<d;++a)n[l[a].getKey()]=!0}return n},{});super.expireCache(e,i),this.sourceTileCache.expireCache(r)}getSourceTiles(e,i,s){if(s.getState()===F.IDLE){s.setState(F.LOADING);const r=s.wrappedTileCoord,n=this.getTileGridForProjection(i),o=n.getTileCoordExtent(r),h=r[0],u=n.getResolution(h);G(o,-u,o);const l=this.tileGrid,a=l.getExtent();a&&Ce(o,a,o);const d=l.getZForResolution(u,this.zDirection);l.forEachTileCoord(o,d,c=>{const g=this.tileUrlFunction(c,e,i),f=this.sourceTileCache.containsKey(g)?this.sourceTileCache.get(g):new this.tileClass(c,g?F.IDLE:F.EMPTY,g,this.format_,this.tileLoadFunction);s.sourceTiles.push(f);const w=f.getState();if(w<F.LOADED){const p=M=>{this.handleTileChange(M);const T=f.getState();if(T===F.LOADED||T===F.ERROR){const S=f.getKey();S in s.errorTileKeys?f.getState()===F.LOADED&&delete s.errorTileKeys[S]:s.loadingSourceTiles--,T===F.ERROR?s.errorTileKeys[S]=!0:f.removeEventListener(O.CHANGE,p),s.loadingSourceTiles===0&&s.setState(Ve(s.errorTileKeys)?F.LOADED:F.ERROR)}};f.addEventListener(O.CHANGE,p),s.loadingSourceTiles++}w===F.IDLE&&(f.extent=l.getTileCoordExtent(c),f.projection=i,f.resolution=l.getResolution(c[0]),this.sourceTileCache.set(g,f),f.load())}),s.loadingSourceTiles||s.setState(s.sourceTiles.some(c=>c.getState()===F.ERROR)?F.ERROR:F.LOADED)}return s.sourceTiles}getTile(e,i,s,r,n){const o=Me(e,i,s),h=this.getKey();let u;if(this.tileCache.containsKey(o)&&(u=this.tileCache.get(o),u.key===h))return u;const l=[e,i,s];let a=this.getTileCoordForTileUrlFunction(l,n);const d=this.getTileGrid().getExtent(),c=this.getTileGridForProjection(n);if(a&&d){const w=c.getTileCoordExtent(a);G(w,-c.getResolution(e),w),D(d,w)||(a=null)}let g=!0;if(a!==null){const w=this.tileGrid,p=c.getResolution(e),M=w.getZForResolution(p,1),T=c.getTileCoordExtent(a);G(T,-p,T),w.forEachTileCoord(T,M,S=>{g=g&&!this.tileUrlFunction(S,r,n)})}const f=new ct(l,g?F.EMPTY:F.IDLE,a,this.getSourceTiles.bind(this,r,n));return f.key=h,u?(f.interimTile=u,f.refreshInterimChain(),this.tileCache.replace(o,f)):this.tileCache.set(o,f),f}getTileGridForProjection(e){const i=e.getCode();let s=this.tileGrids_[i];if(!s){const r=this.tileGrid,n=r.getResolutions().slice(),o=n.map(function(l,a){return r.getOrigin(a)}),h=n.map(function(l,a){return r.getTileSize(a)}),u=ve+1;for(let l=n.length;l<u;++l)n.push(n[l-1]/2),o.push(o[l-1]),h.push(h[l-1]);s=new Y({extent:r.getExtent(),origins:o,resolutions:n,tileSizes:h}),this.tileGrids_[i]=s}return s}getTilePixelRatio(e){return e}getTilePixelSize(e,i,s){const r=this.getTileGridForProjection(s),n=Pe(r.getTileSize(e),this.tmpSize);return[Math.round(n[0]*i),Math.round(n[1]*i)]}updateCacheSize(e,i){super.updateCacheSize(e*2,i),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(i).highWaterMark}}const xt=ft;function gt(t,e){t.setLoader(function(i,s,r){Ee(e,t.getFormat(),i,s,r,t.onLoad.bind(t),t.onError.bind(t))})}class Ft extends Y{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}const wt=Ft;class yt extends De{constructor(e){const i=e.requestEncoding!==void 0?e.requestEncoding:"KVP",s=e.tileGrid;let r=e.urls;r===void 0&&e.url!==void 0&&(r=Ge(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:s,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=i,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=j(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const i=e.join(`
`);this.setTileUrlFunction(j(e.map(this.createFromWMTSTemplate.bind(this))),i)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const i in this.dimensions_)e.push(i+"-"+this.dimensions_[i]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const i=this.requestEncoding_,s={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};i=="KVP"&&Object.assign(s,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=i=="KVP"?z(e,s):e.replace(/\{(\w+?)\}/g,function(o,h){return h.toLowerCase()in s?s[h.toLowerCase()]:o});const r=this.tileGrid,n=this.dimensions_;return function(o,h,u){if(!o)return;const l={TileMatrix:r.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(l,n);let a=e;return i=="KVP"?a=z(a,l):a=a.replace(/\{(\w+?)\}/g,function(d,c){return l[c]}),a}}}const pt=yt,V=Ie(),Tt=t=>{let i=k("EPSG:3857").getExtent(),s=ke(i)/256,r=[],n=[];for(let o=0;o<30;++o){let h=s/Math.pow(2,o);if(r.push(h),n.push("EPSG:900913:"+o),h<t)break}return new wt({origin:Be(i),resolutions:r,matrixIds:n})},Ct=(t,e,i)=>new Re({extent:e,source:new pt({url:V.setting.geoserver.publicUrl+"/gwc/service/wmts",layer:V.setting.geoserver.workspace+":"+t,matrixSet:"EPSG:900913",format:"image/png",style:"",tileGrid:Tt(i)})}),Pt=t=>new xt({format:new lt,tileGrid:$(),url:`${V.setting.geoserver.publicUrl}/gwc/service/tms/1.0.0/${V.setting.geoserver.workspace}:${t}_shp@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf`});export{Pt as a,Ct as c};
