import{r as ue,u as pe}from"./xlsx-4f9172c7.js";import{B as _e}from"./BaseTitle-588acb84.js";import{c as me}from"./format-aee67674.js";import{d as j,c as r,o as u,e as h,f as k,t as H,s as P,m as F,w as t,h as e,g as m,au as fe,z as L,_ as W,r as g,F as $,q as G,a7 as oe,G as ve,D as Z,H as te,S as ge,l as V,i as b,a6 as ye,W as Ce,p as he,n as ke,a5 as le,a as we,E as Y}from"./index-ab68adb5.js";import{C as be}from"./index-f53ede3a.js";function ae(){return{colors:["#03a9f4","#00bcd4","#009688","#8a4af3","#ff5722","#e91e63"],getBackgroundColor:_=>be(_).alpha(.1).string()}}const Ve=j({__name:"CategoryItem",props:{color:{type:String,default:"#409EFF"},name:{type:String,default:"空"},removeable:{type:Boolean,default:!0}},emits:["detach"],setup(y,{emit:v}){const{getBackgroundColor:_}=ae(),p=()=>{v("detach")};return(c,D)=>{const d=r("el-icon");return u(),h("div",{class:"category-item",style:P({backgroundColor:m(_)(y.color)})},[k("span",{style:P({color:y.color})},H(y.name),5),y.removeable?(u(),F(d,{key:0,class:"category-item-remove",style:P({color:y.color}),onClick:p},{default:t(()=>[e(m(fe))]),_:1},8,["style"])):L("",!0)],4)}}});const ne=W(Ve,[["__scopeId","data-v-5364017e"]]),xe={class:"color-picker"},Ie=["onClick"],$e=j({__name:"CategoryColorPicker",setup(y,{expose:v}){const{colors:_}=ae(),p=g(),c=f=>{p.value=f};return v({setCheckedColor:f=>{p.value=_.findIndex(B=>B==f)},getCheckedColor:()=>_[p.value]}),(f,B)=>{const A=r("el-icon");return u(),h("ul",xe,[(u(!0),h($,null,G(m(_),(x,w)=>(u(),h("li",{key:w},[k("div",{class:"color-circle-button",style:P({backgroundColor:x}),onClick:S=>c(w)},[e(A,{class:ve({checked:w==p.value})},{default:t(()=>[e(m(oe))]),_:2},1032,["class"])],12,Ie)]))),128))])}}});const ee=W($e,[["__scopeId","data-v-aabc1553"]]),De=y=>(he("data-v-718ee402"),y=y(),ke(),y),Be={class:"category-list"},Se=["onClick"],Ue={class:"category-circle-wrap"},Te={class:"category-name"},Ee={key:2},Ae={key:3},Le={class:"edit-header"},Pe=De(()=>k("div",null,"编辑分类",-1)),Fe=j({__name:"Category",props:["modelValue"],emits:["update:modelValue"],setup(y,{emit:v}){const _=y,p=g(""),c=g(),D=g(),d=g(),f=g([]),B=Z(()=>f.value.filter(i=>!p.value||i.name.toLowerCase().includes(p.value.toLowerCase()))),A=g([]);te(async()=>{await w(),x(_.modelValue)}),ge(()=>_.modelValue,i=>{x(i)});const x=i=>{A.value=f.value.filter(n=>i.includes(n.id)),f.value.map(n=>{n.checked=i.includes(n.id)})},w=async()=>{f.value=await V.get("api/Category/GetAll")},S=()=>{d.value=void 0},J=async()=>{let i=p.value;p.value="",await V.post("/api/Category/Create",{name:i,color:c.value.getCheckedColor()}),await w();let n=f.value.find(o=>o.name==i),l=[..._.modelValue];l.push(n.id),v("update:modelValue",l)},K=i=>{d.value=i,le(()=>{D.value.setCheckedColor(i.color)})},O=async()=>{await V.post("/api/Category/Update",{id:d.value.id,name:d.value.name,color:D.value.getCheckedColor()}),await w(),x(_.modelValue),d.value=void 0},Q=async()=>{q(d.value),await V.post("/api/Category/Delete/"+d.value.id),await w(),x(_.modelValue),d.value=void 0},X=i=>{let n=[..._.modelValue],l=n.findIndex(o=>o==i.id);l>=0?n.splice(l,1):n.push(i.id),v("update:modelValue",n)},q=i=>{let n=[..._.modelValue],l=n.findIndex(o=>o==i.id);n.splice(l,1),v("update:modelValue",n)};return(i,n)=>{const l=r("el-input"),o=r("el-icon"),C=r("el-empty"),I=r("el-button"),U=r("el-popconfirm"),M=r("el-col"),T=r("el-row"),E=r("el-popover");return u(),h($,null,[(u(!0),h($,null,G(A.value,s=>(u(),F(ne,{key:s.id,color:s.color,name:s.name,onDetach:z=>q(s)},null,8,["color","name","onDetach"]))),128)),e(E,{placement:"bottom-start","show-arrow":!1,width:240,trigger:"click",onHide:S},{reference:t(()=>[e(I,{type:"primary",text:""},{default:t(()=>[b("添加")]),_:1})]),default:t(()=>[k("div",null,[d.value==null?(u(),h($,{key:0},[e(l,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=s=>p.value=s),placeholder:"搜索分类"},null,8,["modelValue"]),k("ul",Be,[(u(!0),h($,null,G(B.value,s=>(u(),h("li",{key:s.id,class:"category-list-item",onClick:z=>X(s)},[k("div",Ue,[k("div",{class:"category-circle",style:P({backgroundColor:s.color})},null,4)]),k("div",Te,H(s.name),1),e(o,{class:"category-edit",onClick:ye(z=>K(s),["stop"])},{default:t(()=>[e(m(Ce))]),_:2},1032,["onClick"]),s.checked?(u(),F(o,{key:0},{default:t(()=>[e(m(oe))]),_:1})):L("",!0)],8,Se))),128))])],64)):L("",!0),f.value.length==0&&p.value==""?(u(),F(C,{key:1,"image-size":56,description:"暂无标签"})):L("",!0),B.value.length==0&&p.value!=""?(u(),h("div",Ee,[e(ee,{ref_key:"categoryColorPickerRef",ref:c},null,512),e(I,{type:"primary",plain:"",style:{width:"100%"},onClick:J},{default:t(()=>[b("新建")]),_:1})])):L("",!0),d.value!=null?(u(),h("div",Ae,[k("div",Le,[k("i",{class:"el-icon-arrow-left icon-goback",onClick:n[1]||(n[1]=s=>d.value=void 0)}),Pe]),e(l,{modelValue:d.value.name,"onUpdate:modelValue":n[2]||(n[2]=s=>d.value.name=s),placeholder:"分类名称"},null,8,["modelValue"]),e(ee,{ref_key:"categoryColorPickerEditRef",ref:D},null,512),e(T,{gutter:16},{default:t(()=>[e(M,{span:12},{default:t(()=>[e(U,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此类别么?",onConfirm:Q},{reference:t(()=>[e(I,{type:"danger",plain:"",style:{width:"100%"}},{default:t(()=>[b("删除")]),_:1})]),_:1})]),_:1}),e(M,{span:12},{default:t(()=>[e(I,{type:"primary",style:{width:"100%"},onClick:O},{default:t(()=>[b("完成")]),_:1})]),_:1})]),_:1})])):L("",!0)])]),_:1})],64)}}});const Me=W(Fe,[["__scopeId","data-v-718ee402"]]),Ne={class:"flex-gap-8"},Re={class:"category-list"},Ge={class:"category-list"},qe=j({__name:"Index",setup(y){const v=g(!1),_=g(""),p=g();let c=g({id:void 0,name:"",desc:"",color:"",categoryIds:[],continuity:!1});const D=we({name:[{required:!0,message:"请请输入名称",trigger:"blur"}],color:[{required:!0,message:"请选择颜色",trigger:"change"}]}),d=g(""),f=g([]),B=Z(()=>f.value.filter(l=>!d.value||l.name.toLowerCase().includes(d.value.toLowerCase())||l.desc.toLowerCase().includes(d.value.toLowerCase()))),A=Z(()=>c.value.id?"编辑":"新建"),x=g(["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585"]),w=g();te(()=>{S()});const S=async()=>{w.value=await V.get("api/Category/GetAll"),V.get("api/Tag/GetAll").then(l=>{f.value=l})},J=l=>{V.get("/api/Tag/GetAll").then(o=>{l=="all"?f.value=o:f.value=o.filter(C=>C.categoryIds.includes(l))})},K=l=>w.value.filter(o=>l.includes(o.id)),O=()=>{var l;(l=p.value)==null||l.resetFields(),c.value.id=void 0},Q=()=>{v.value=!0},X=async()=>{var l;(l=p.value)==null||l.validate(o=>{if(o){let C=c.value.id?"Update":"Create";V.post("api/Tag/"+C,c.value).then(()=>{v.value=!1,S(),Y({message:"提交成功",type:"success"})})}})},q=l=>{v.value=!0,le(()=>{c.value={...l}})},i=l=>{V.post("api/Tag/Delete/"+l.id).then(()=>{S(),Y({type:"success",message:"删除成功"})})},n=l=>{const o=new FileReader,C=l.raw;o.readAsBinaryString(C),o.onload=()=>{var I=o.result;let U=ue(I,{type:"binary"}),T=pe.sheet_to_json(U.Sheets[U.SheetNames[0]]).map(E=>({Name:E.标签名称,Color:E.标签颜色,Continuity:E.连续地物=="是"}));V.post("/api/Tag/BatchCreate",T).then(()=>{S(),Y({message:"导入成功",type:"success"})})}};return(l,o)=>{const C=r("el-button"),I=r("el-upload"),U=r("el-option"),M=r("el-select"),T=r("el-input"),E=r("el-divider"),s=r("el-table-column"),z=r("el-popconfirm"),se=r("el-table"),N=r("el-form-item"),re=r("el-switch"),ce=r("el-color-picker"),de=r("el-form"),ie=r("el-dialog");return u(),h($,null,[e(_e,{title:"标签管理",icon:"icon-discount"}),k("div",Ne,[e(C,{type:"primary",onClick:Q},{default:t(()=>[b("新建标签")]),_:1}),e(I,{accept:".xls,.xlsx","auto-upload":!1,"show-file-list":!1,action:"","on-change":n},{trigger:t(()=>[e(C,{type:"primary",plain:""},{default:t(()=>[b("导入标签")]),_:1})]),_:1}),e(T,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=a=>d.value=a),modelModifiers:{trim:!0},style:{width:"300px"},placeholder:"请输入关键字搜索",clearable:""},{prepend:t(()=>[e(M,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=a=>_.value=a),style:{width:"100px"},placeholder:"选择分类",onChange:J},{default:t(()=>[e(U,{label:"全选",value:"all"}),(u(!0),h($,null,G(w.value,a=>(u(),F(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),e(E),e(se,{data:B.value,height:"calc(100vh - 223px)"},{default:t(()=>[e(s,{type:"index",width:"50"}),e(s,{prop:"name",label:"标签名称"}),e(s,{prop:"color",label:"标签颜色",width:"150"},{default:t(a=>[k("div",{class:"colorTag",style:P({background:a.row.color})},H(a.row.color),5)]),_:1}),e(s,{prop:"tagIds",label:"标签分类",width:"300"},{default:t(a=>[k("div",Re,[(u(!0),h($,null,G(K(a.row.categoryIds),R=>(u(),F(ne,{key:R.id,color:R.color,name:R.name,removeable:!1},null,8,["color","name"]))),128))])]),_:1}),e(s,{prop:"isContinuity",label:"连续地类",width:"120"},{default:t(a=>[b(H(m(me)(a.row.continuity)),1)]),_:1}),e(s,{prop:"desc",label:"标签描述"}),e(s,{width:"120","class-name":"hover-to-show"},{default:t(a=>[e(C,{type:"primary",link:"",onClick:R=>q(a.row)},{default:t(()=>[b("编辑")]),_:2},1032,["onClick"]),e(z,{width:"170","confirm-button-text":"删除","cancel-button-text":"取消",title:"确认删除此标签么?",onConfirm:R=>i(a.row)},{reference:t(()=>[e(C,{type:"danger",link:""},{default:t(()=>[b("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(ie,{title:A.value,modelValue:v.value,"onUpdate:modelValue":o[8]||(o[8]=a=>v.value=a),"close-on-click-modal":!1,width:"500px",top:"60px",onClosed:O},{footer:t(()=>[e(C,{onClick:o[7]||(o[7]=a=>v.value=!1)},{default:t(()=>[b("取消")]),_:1}),e(C,{type:"primary",onClick:X},{default:t(()=>[b("提交")]),_:1})]),default:t(()=>[e(de,{model:m(c),rules:D,ref_key:"formRef",ref:p,"label-position":"top"},{default:t(()=>[e(N,{label:"标签名称",prop:"name"},{default:t(()=>[e(T,{modelValue:m(c).name,"onUpdate:modelValue":o[2]||(o[2]=a=>m(c).name=a),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),e(N,{label:"连续地类",prop:"continuity"},{default:t(()=>[e(re,{modelValue:m(c).continuity,"onUpdate:modelValue":o[3]||(o[3]=a=>m(c).continuity=a)},null,8,["modelValue"])]),_:1}),e(N,{label:"标签颜色",prop:"color"},{default:t(()=>[e(ce,{modelValue:m(c).color,"onUpdate:modelValue":o[4]||(o[4]=a=>m(c).color=a),predefine:x.value},null,8,["modelValue","predefine"])]),_:1}),e(N,{label:"标签分类",prop:"categoryIds"},{default:t(()=>[k("div",Ge,[e(Me,{modelValue:m(c).categoryIds,"onUpdate:modelValue":o[5]||(o[5]=a=>m(c).categoryIds=a)},null,8,["modelValue"])])]),_:1}),e(N,{label:"标签描述",prop:"desc"},{default:t(()=>[e(T,{modelValue:m(c).desc,"onUpdate:modelValue":o[6]||(o[6]=a=>m(c).desc=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])],64)}}});const Ke=W(qe,[["__scopeId","data-v-c2b64a64"]]);export{Ke as default};
