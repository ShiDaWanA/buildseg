import{d as ee,r as f,H as ce,l as A,a as xe,c as o,o as p,m as R,w as t,h as e,i as v,g as b,e as B,q as F,F as H,E as Z,z as Q,S as we,a5 as ke,I as le,f as r,s as ae,J as me,K as _e,a6 as Ce,Q as oe,p as ne,n as ie,_ as re,D as se,t as z,a7 as ue,P as fe,U as Se,G as Ie,a8 as $e}from"./index-ab68adb5.js";import{B as Ee}from"./BaseTitle-588acb84.js";import{u as ve,B as X,T as Ve,E as pe}from"./useSetting-1e631b4e.js";import{C as Te}from"./CustomAttributes-f30ba1f9.js";import{_ as Le}from"./mac-folder-48-c5b4c709.js";import{_ as Re}from"./picture-48-70f98f1e.js";import{u as Be,S as Ue,a as De,i as Ne}from"./index.esm.min-90f1887f.js";import{C as Ge}from"./index-f53ede3a.js";import{i as Me}from"./install-95d77889.js";import{i as ze}from"./install-7ec1e6c2.js";import{i as Ae}from"./install-def00ef4.js";import{H as Pe}from"./HubConnectionBuilder-04baf802.js";const He=ee({__name:"ExampleSetCreate",emits:["success"],setup(U,{expose:w,emit:G}){w({show:()=>{x.value=!0}});const x=f(!1),{taskTypeList:s}=ve();let Y=[];ce(async()=>{Y=await A.get("api/Tag/GetAll")});const V=[512,1024],M=(E,d,g)=>{u.value.type==""?g():u.value.type=="change"?d.length>0?g(new Error("变化检测样本库无需选择标签")):g():d.length>0?g():g(new Error("请选择标签"))},P=f(),N=f();let u=f({name:"",tagIds:[],tileSize:512,type:"",desc:""});const J=xe({name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{max:50,message:"数据集名称需少于 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择样本库类型",trigger:"change"}],tagIds:[{validator:M,trigger:"change"}]}),$=()=>{var E;(E=N.value)==null||E.validate(d=>{if(d){let g=P.value.getAttribute();A.post("api/ExampleSet/Create",{...u.value,customAttributes:g==null?null:JSON.stringify(g)}).then(()=>{Z({type:"success",message:"新建成功"}),G("success"),x.value=!1})}})},_=()=>{var E;(E=N.value)==null||E.resetFields(),P.value.clearAttribute()};return(E,d)=>{const g=o("el-input"),y=o("el-form-item"),D=o("el-option"),a=o("el-select"),h=o("el-col"),T=o("el-row"),n=o("el-form"),c=o("el-button"),i=o("el-dialog");return p(),R(i,{title:"新建样本库",modelValue:x.value,"onUpdate:modelValue":d[6]||(d[6]=l=>x.value=l),"close-on-click-modal":!1,width:"500px",onClosed:_},{footer:t(()=>[e(c,{onClick:d[5]||(d[5]=l=>x.value=!1)},{default:t(()=>[v("取消")]),_:1}),e(c,{type:"primary",onClick:$},{default:t(()=>[v("提交")]),_:1})]),default:t(()=>[e(n,{model:b(u),rules:J,ref_key:"formRef",ref:N,"label-position":"top"},{default:t(()=>[e(y,{label:"样本库名称",prop:"name"},{default:t(()=>[e(g,{modelValue:b(u).name,"onUpdate:modelValue":d[0]||(d[0]=l=>b(u).name=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),e(y,{label:"标签",prop:"tagIds"},{default:t(()=>[e(a,{placeholder:"请选择标签",modelValue:b(u).tagIds,"onUpdate:modelValue":d[1]||(d[1]=l=>b(u).tagIds=l),multiple:"",style:{width:"100%"}},{default:t(()=>[(p(!0),B(H,null,F(b(Y),l=>(p(),R(D,{key:l.id,label:l.name,value:l.id},{default:t(()=>[e(X,{name:l.name,color:l.color,style:{height:"100%"}},null,8,["name","color"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(T,{gutter:16},{default:t(()=>[e(h,{span:12},{default:t(()=>[e(y,{label:"样本库类型",prop:"type"},{default:t(()=>[e(a,{placeholder:"请选择类型",modelValue:b(u).type,"onUpdate:modelValue":d[2]||(d[2]=l=>b(u).type=l),style:{width:"100%"}},{default:t(()=>[(p(!0),B(H,null,F(b(s),l=>(p(),R(D,{key:l.name,label:l.title,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12},{default:t(()=>[e(y,{label:"切片大小",prop:"tileSize"},{default:t(()=>[e(a,{placeholder:"请选择切片大小",modelValue:b(u).tileSize,"onUpdate:modelValue":d[3]||(d[3]=l=>b(u).tileSize=l),style:{width:"100%"}},{default:t(()=>[(p(),B(H,null,F(V,l=>e(D,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{label:"自定义属性"},{default:t(()=>[e(Te,{ref_key:"customAttributesRef",ref:P},null,512)]),_:1}),e(y,{label:"描述",prop:"desc"},{default:t(()=>[e(g,{type:"textarea",placeholder:"请输入描述",modelValue:b(u).desc,"onUpdate:modelValue":d[4]||(d[4]=l=>b(u).desc=l),maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Ye=ee({__name:"ReserveClip",setup(U,{expose:w}){const G=f(!1),k=f(""),x=f(),s=f(!1);w({show:N=>{G.value=!0,k.value=N.appointment,x.value=N}});const V=()=>{A.post("api/ExampleSet/Reserve",{ExampleSetId:x.value.id,Appointment:k.value}).then(()=>{Z({message:"保存成功",type:"success"}),G.value=!1,x.value.appointment=k.value,x.value.isReserved=k.value!=null})},M=()=>{k.value=null,V()},P=N=>N.getTime()<Date.now();return(N,u)=>{const J=o("el-alert"),$=o("el-date-picker"),_=o("el-form-item"),E=o("el-form"),d=o("el-button"),g=o("el-dialog");return p(),R(g,{title:"预约切片",modelValue:G.value,"onUpdate:modelValue":u[4]||(u[4]=y=>G.value=y),"close-on-click-modal":!1,width:"350px"},{footer:t(()=>[e(d,{onClick:u[1]||(u[1]=y=>G.value=!1)},{default:t(()=>[v("关闭")]),_:1}),x.value.isReserved?(p(),R(d,{key:0,type:"primary",onClick:M},{default:t(()=>[v("取消")]),_:1})):Q("",!0),x.value.isReserved?(p(),R(d,{key:1,type:"primary",onClick:u[2]||(u[2]=y=>s.value=!0)},{default:t(()=>[v("更改")]),_:1})):Q("",!0),x.value.isReserved?Q("",!0):(p(),R(d,{key:2,type:"primary",onClick:u[3]||(u[3]=y=>V())},{default:t(()=>[v("预约")]),_:1}))]),default:t(()=>[x.value.isReserved?(p(),R(J,{key:0,title:"已预约切片时间，可取消或修改",type:"success",closable:!1,style:{"margin-bottom":"16px"}})):Q("",!0),e(E,{"label-position":"left"},{default:t(()=>[e(_,{label:"处理时间"},{default:t(()=>[e($,{modelValue:k.value,"onUpdate:modelValue":u[0]||(u[0]=y=>k.value=y),type:"datetime",placeholder:"选择日期时间","disabled-date":P,format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",disabled:x.value.isReserved},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Oe=U=>(ne("data-v-5bc9801d"),U=U(),ie(),U),je={style:{display:"flex","justify-content":"space-between"}},Je={style:{display:"flex","align-items":"center"}},Fe=Oe(()=>r("span",{style:{float:"left","margin-right":"4px","line-height":"38px","font-size":"14px"}},"透明度",-1)),qe={style:{display:"flex","flex-wrap":"wrap","max-height":"726px",overflow:"auto"}},Ke=["id","onClick"],Qe=["id"],We={class:"tile_viewer_content"},Xe=ee({__name:"TileListView",props:["example","exampleSet"],setup(U){const w=U,G=f(!1),k=f(1),x=f(50),s=f(0),Y=f([]),V=f(60),M=f(!1);we(()=>w.example,()=>{u()});const P=()=>{u()},N=()=>{k.value=1,u()},u=()=>{if(w.example==null)return;let $=[];w.exampleSet.tags.length==0?$.push([255,0,0]):w.exampleSet.tags.forEach(_=>{$.push(Ge(_.color).rgb().array())}),A.get("api/ExampleSet/GetExampleTileList",{params:{id:w.example.id,page:k.value,size:x.value,onlyTileLabel:G.value}}).then(_=>{s.value=_.total,Y.value=_.tiles,ke(()=>{let E=_.tiles,d=_.fileName;for(let g=0;g<E.length;g++){let y=E[g],a=document.getElementById(`tile_canvas_${g}`).getContext("2d");a.clearRect(0,0,512,512);let h=document.getElementById(`tile_wrapper_${g}`);if(h.style.backgroundImage=`url('${le}/api/ExampleSet/GetTile?exampleSetId=${w.example.exampleSetId}&exampleId=${w.example.id}&fileName=${d}_${y}.jpg')`,w.example.type=="seg"||w.example.type=="change"){let T=new Image;T.crossOrigin="",T.src=`${le}/api/ExampleSet/GetTile?exampleSetId=${w.example.exampleSetId}&exampleId=${w.example.id}&fileName=${d}-label_${y}.png`,T.onload=()=>{const n=document.createElement("canvas");n.width=512,n.height=512;const c=n.getContext("2d");c.drawImage(T,0,0);let i=c.getImageData(0,0,512,512);const l=i.data;for(let m=0;m<l.length;m+=4){let L=l[m];if(L==0)l[m]=0,l[m+1]=0,l[m+2]=0,l[m+3]=0;else{let q=$[L-1];l[m]=q[0],l[m+1]=q[1],l[m+2]=q[2],l[m+3]=255}}c.putImageData(i,0,0);let I=new Image;I.src=n.toDataURL(),I.onload=()=>{a.drawImage(I,0,0)}}}else A.get(`api/ExampleSet/GetVectorTile?exampleSetId=${w.example.exampleSetId}&exampleId=${w.example.id}&fileName=${d}_${y}.json`).then(T=>{if(T==null)return;JSON.parse(T).features.forEach(i=>{a.beginPath(),a.moveTo(i.geometry.coordinates[0][0][0],i.geometry.coordinates[0][0][1]),i.geometry.coordinates[0].forEach(I=>{a.lineTo(I[0],I[1])}),a.closePath();let l=w.example.tags.find(I=>I.id==i.properties.tagId);a.fillStyle=l.color,a.fill(),a.closePath()})})}})})},J=$=>{let _=document.getElementById(`tile_wrapper_${$}`),E=document.getElementById("tile_viewer_div");E.style.backgroundImage=_.style.backgroundImage;let d=document.getElementById(`tile_canvas_${$}`),y=document.getElementById("tile_viewer_canvas").getContext("2d");y.clearRect(0,0,512,512),y.drawImage(d,0,0),M.value=!0};return($,_)=>{const E=o("el-switch"),d=o("el-slider"),g=o("el-pagination"),y=o("el-icon");return p(),B(H,null,[r("div",je,[r("div",Je,[e(E,{modelValue:G.value,"onUpdate:modelValue":_[0]||(_[0]=D=>G.value=D),onChange:N,"active-text":"只正样本","inactive-text":"全部",style:{"margin-right":"16px"}},null,8,["modelValue"]),Fe,e(d,{style:{float:"left",width:"150px"},modelValue:V.value,"onUpdate:modelValue":_[1]||(_[1]=D=>V.value=D),"show-tooltip":!1},null,8,["modelValue"])])]),r("div",qe,[(p(!0),B(H,null,F(Y.value,(D,a)=>(p(),B("div",{key:a,id:`tile_wrapper_${a}`,class:"tile_list_wrapper",onClick:h=>J(a)},[r("canvas",{width:"512",height:"512",id:`tile_canvas_${a}`,class:"tile",style:ae({opacity:V.value/100})},null,12,Qe)],8,Ke))),128))]),e(g,{onCurrentChange:P,"current-page":k.value,"onUpdate:currentPage":_[2]||(_[2]=D=>k.value=D),"page-size":x.value,layout:"total,prev, pager, next",total:s.value},null,8,["current-page","page-size","total"]),me(r("div",{class:"tile_viewer_wrapper",onClick:_[5]||(_[5]=D=>M.value=!1)},[r("div",We,[r("div",{id:"tile_viewer_div",onClick:_[3]||(_[3]=Ce(()=>{},["stop"]))},[r("canvas",{width:"512",height:"512",id:"tile_viewer_canvas",style:ae({opacity:V.value/100})},null,4)]),r("span",{class:"tile_viewer_close",onClick:_[4]||(_[4]=D=>M.value=!1)},[e(y,null,{default:t(()=>[e(b(oe))]),_:1})])])],512),[[_e,M.value]])],64)}}});const Ze=re(Xe,[["__scopeId","data-v-5bc9801d"]]),ge=U=>(ne("data-v-24c9ff4d"),U=U(),ie(),U),et={class:"flex-gap-8"},tt={style:{"margin-top":"16px"}},lt={class:"flex-gap-8"},at={class:"flex-gap-8"},ot={key:0,class:"directory directory_mini"},st=ge(()=>r("img",{class:"directory_icon",src:Le},null,-1)),nt={class:"directory_name"},it={key:1,style:{display:"flex","align-items":"center","justify-content":"space-between"}},rt={class:"directory directory_mini"},dt=ge(()=>r("img",{class:"directory_icon",src:Re},null,-1)),ut={class:"directory_name"},pt={key:0,class:"directory_name"},ct=ee({__name:"ExampleSetDetail",emits:["close"],setup(U,{expose:w,emit:G}){Be([De,ze,Ae,Me,Ne]);const k=f(!1),x=f(!1),s=f({});w({show:n=>{x.value=!0,s.value=n,u()}});const V=f(""),M=f([]),P=f([]),N=se(()=>M.value.filter(n=>!V.value||n.name.toLowerCase().includes(V.value.toLowerCase()))),u=()=>{A.get("api/ExampleSet/GetExampleList/"+s.value.id).then(n=>{M.value=n})},J=n=>{P.value=n},$=f(),_=()=>{let c=$.value.getCheckedNodes(!0).map(i=>i.id);A.post("api/ExampleSet/AddExample",{labelIds:c,exampleSetId:s.value.id,type:s.value.type}).then(()=>{k.value=!1,u(),d(),Z({message:"添加成功",type:"success"})})},E=()=>{fe.confirm("确认删除样本么?","提示",{showConfirmButton:!0,confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{let n=P.value.map(c=>c.id);A({method:"POST",url:"api/ExampleSet/DeleteExample/",data:n}).then(()=>{u(),d(),Z({message:"删除成功",type:"success"})})})},d=()=>{A.get(`api/ExampleSet/GetById/${s.value.id}`).then(n=>{s.value=n})},g=se(()=>{let n=[],c=[];return s.value.type=="change"?(n.push("#f44336"),c.push("变化图斑")):s.value.tags.forEach(i=>{n.push(i.color),c.push(i.name)}),{tooltip:{appendToBody:!0,trigger:"item"},xAxis:{type:"value",max:s.value.tileImageCount,interval:s.value.tileImageCount,axisLabel:{show:!1,showMaxLabel:!0}},yAxis:{type:"category",data:c},grid:{top:10,bottom:10,left:"40%",right:16,containLabel:!0},series:[{type:"bar",showBackground:!0,label:{position:"insideLeft",show:!0},data:s.value.labelSummary.map(i=>i.tileCount),itemStyle:{color:i=>n[i.dataIndex]},tooltip:{appendToBody:!0,trigger:"item",formatter:"{b}<br/>正样本数: {c}"}},{type:"pie",center:["20%","50%"],radius:[0,"30%"],label:{position:"inner",fontSize:12},data:s.value.labelSummary.map(i=>({value:i.labelCount,name:i.tagName})),tooltip:{appendToBody:!0,trigger:"item",formatter:"{b}<br/>标注数: {c} ({d}%)"}},{type:"pie",center:["20%","50%"],radius:["40%","60%"],data:s.value.labelSummary.map(i=>({value:i.labelArea,name:i.tagName})),tooltip:{appendToBody:!0,trigger:"item",formatter:"{b}<br/>面积占比: {d}%"}}],color:n}}),y={label:"imageName",isLeaf:"leaf",disabled:"disabled"},D=async(n,c)=>{let i;n.level!=0&&(i=n.data.id);let l=await A.get("api/Dataset/GetDatasets",{params:{datasetId:i,type:s.value.type}});if(l.forEach(L=>{L.type="dataset"}),n.level===0)return c(l);let I=await A.get("api/Label/GetLabelsInDataset/",{params:{datasetId:i}});console.log("🚀 ~ file: ExampleSetDetail.vue:344 ~ loadNode ~ labels:",I),I.forEach(L=>{L.leaf=!0,L.type="label",s.value.type!="change"&&(L.tagIds.some(C=>s.value.tagIds.includes(C))||(L.disabled=!0))});let m=[...l,...I];return c(m)},a=()=>{G("close"),h.value=null},h=f(),T=n=>{h.value==n?h.value=null:h.value=n};return(n,c)=>{const i=o("el-descriptions-item"),l=o("el-descriptions"),I=o("el-col"),m=o("el-row"),L=o("el-button"),q=o("el-button-group"),C=o("el-input"),O=o("el-table-column"),W=o("el-icon"),K=o("el-table"),de=o("el-dialog"),he=o("el-tree"),be=o("el-scrollbar");return p(),B(H,null,[e(de,{title:s.value.name,modelValue:x.value,"onUpdate:modelValue":c[2]||(c[2]=S=>x.value=S),"close-on-click-modal":!1,width:"1400px",top:"60px",onClose:a},{default:t(()=>[e(m,{gutter:16},{default:t(()=>[e(I,{span:h.value!=null?16:24},{default:t(()=>[e(m,{gutter:16},{default:t(()=>[e(I,{span:8},{default:t(()=>[e(l,{column:4,direction:"vertical",border:""},{default:t(()=>[e(i,{label:"切片数"},{default:t(()=>[v(z(s.value.tileImageCount),1)]),_:1}),e(i,{label:"正样本"},{default:t(()=>[v(z(s.value.tileLabelCount),1)]),_:1}),e(i,{label:"负样本"},{default:t(()=>[v(z(s.value.tileImageCount-s.value.tileLabelCount),1)]),_:1}),e(i,{label:"标注数"},{default:t(()=>[v(z(s.value.labelCount),1)]),_:1}),e(i,{label:"创建日期",span:2},{default:t(()=>[v(z(s.value.created),1)]),_:1}),e(i,{label:"更新日期",span:2},{default:t(()=>[v(z(s.value.updated),1)]),_:1}),e(i,{label:"标签",span:3},{default:t(()=>[r("div",et,[(p(!0),B(H,null,F(s.value.tags,S=>(p(),R(X,{key:S.id,name:S.name,color:S.color},null,8,["name","color"]))),128))])]),_:1})]),_:1})]),_:1}),e(I,{span:16},{default:t(()=>[e(b(Ue),{class:"chart",option:g.value,autoresize:""},null,8,["option"])]),_:1})]),_:1}),r("div",tt,[r("div",lt,[e(q,null,{default:t(()=>[e(L,{type:"primary",disabled:s.value.isUpdating,plain:"",onClick:c[0]||(c[0]=S=>k.value=!0)},{default:t(()=>[v("添加")]),_:1},8,["disabled"]),e(L,{type:"primary",disabled:s.value.isUpdating,plain:""},{default:t(()=>[v("上传")]),_:1},8,["disabled"]),e(L,{type:"primary",disabled:P.value.length==0||s.value.isUpdating,plain:"",onClick:E},{default:t(()=>[v("删除")]),_:1},8,["disabled"])]),_:1}),e(C,{modelValue:V.value,"onUpdate:modelValue":c[1]||(c[1]=S=>V.value=S),modelModifiers:{trim:!0},style:{width:"200px"},placeholder:"搜索",clearable:""},null,8,["modelValue"])]),e(K,{data:N.value,style:{"margin-top":"16px"},height:"500px",onSelectionChange:J},{default:t(()=>[e(O,{type:"selection"}),e(O,{prop:"name",label:"名称","show-overflow-tooltip":""}),e(O,{prop:"tags",label:"标签","show-overflow-tooltip":""},{default:t(S=>[r("div",at,[(p(!0),B(H,null,F(S.row.tags,j=>(p(),R(X,{key:j.id,name:j.name,color:j.color},null,8,["name","color"]))),128))])]),_:1}),e(O,{prop:"labelCount",label:"标注数",width:"90"}),e(O,{prop:"tileImageCount",label:"切片数",width:"90"}),e(O,{prop:"hasGenerate",label:"已切片",width:"70"},{default:t(S=>[e(W,null,{default:t(()=>[S.row.hasGenerate?(p(),R(b(ue),{key:0})):(p(),R(b(oe),{key:1}))]),_:2},1024)]),_:1}),e(O,{prop:"hasGenerate",label:"可更新",width:"70"},{default:t(S=>[e(W,null,{default:t(()=>[S.row.needUpdate?(p(),R(b(ue),{key:0})):(p(),R(b(oe),{key:1}))]),_:2},1024)]),_:1}),e(O,{width:"60","class-name":"hover-to-show"},{default:t(S=>[e(L,{link:"",disabled:!S.row.hasGenerate,onClick:j=>T(S.row)},{default:t(()=>[v("查看")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["span"]),me(e(I,{span:8},{default:t(()=>[e(Ze,{example:h.value,"example-set":s.value},null,8,["example","example-set"])]),_:1},512),[[_e,h.value!=null]])]),_:1})]),_:1},8,["title","modelValue"]),k.value?(p(),R(de,{key:0,title:"选择影像标注",modelValue:k.value,"onUpdate:modelValue":c[4]||(c[4]=S=>k.value=S),"close-on-click-modal":!1,width:"500px"},{footer:t(()=>[e(L,{onClick:c[3]||(c[3]=S=>k.value=!1)},{default:t(()=>[v("取消")]),_:1}),e(L,{type:"primary",onClick:_},{default:t(()=>[v("确定")]),_:1})]),default:t(()=>[e(be,{height:"300px",style:{"background-color":"#ffffff",border:"1px solid #dcdfe6"}},{default:t(()=>[e(he,{ref_key:"treeRef",ref:$,props:y,load:D,"node-key":"id",lazy:"","show-checkbox":"","check-on-click-node":""},{default:t(({node:S,data:j})=>[j.type==="dataset"?(p(),B("div",ot,[st,r("span",nt,z(j.name),1)])):(p(),B("div",it,[r("div",rt,[dt,r("span",ut,z(S.label),1),j.nextImageName?(p(),B("span",pt,"/ "+z(j.nextImageName),1)):Q("",!0),(p(!0),B(H,null,F(j.tags,te=>(p(),R(X,{key:te.id,name:te.name,color:te.color},null,8,["name","color"]))),128))])]))]),_:1},512)]),_:1})]),_:1},8,["modelValue"])):Q("",!0)],64)}}});const mt=re(ct,[["__scopeId","data-v-24c9ff4d"]]),ye=U=>(ne("data-v-42387962"),U=U(),ie(),U),_t={class:"flex-gap-8"},ft={style:{"max-height":"calc(100vh - 223px)",overflow:"auto"}},vt={class:"set-list-wrapper"},gt={class:"set-header"},yt={class:"set-title"},ht={class:"set-content"},bt={class:"set-data-wrapper"},xt={class:"set-data"},wt={class:"set-data-content"},kt={class:"set-data-number"},Ct=ye(()=>r("div",{class:"set-data-name"},"标注数",-1)),St={class:"set-data"},It={class:"set-data-content"},$t={class:"set-data-number"},Et=ye(()=>r("div",{class:"set-data-name"},"切片数",-1)),Vt={class:"set-tags flex-gap-8"},Tt={class:"set-footer"},Lt={class:"set-tips"},Rt={key:1,class:"set-date"},Bt=ee({__name:"Index",setup(U){const{getTaskType:w,getTaskTypeIcon:G,getTaskTypeName:k,getExampleSetStatusName:x}=ve(),s=f();let Y;const V=f(""),M=f([]),P=se(()=>M.value.filter(a=>!V.value||a.name.toLowerCase().includes(V.value.toLowerCase()))),N=a=>!(a==pe.NeedGenerate||a==pe.NeedUpdate);ce(()=>{$(),Y=new Pe().withAutomaticReconnect().withUrl(le+"/TaskHub").build(),Y.start().catch(a=>{console.log("🚀 ~ file: Index.vue:89 ~ onMounted ~ error:",a)}),Y.on("GetProgress",(a,h,T)=>{if(h==Ve.Success)$();else{let n=M.value.find(c=>c.id==a);n.progress=T}})});const u=f(),J=()=>{u.value.show()},$=()=>{A.get("api/ExampleSet/GetAll").then(a=>{a.forEach(h=>{h.progress=0}),M.value=a})},_=(a,h)=>{switch(h){case"delete":D(a);break;case"download":E(a.id);break;case"clip":y(a);break;case"reserve":s.value.show(a);break}},E=a=>{A({method:"GET",url:"/api/ExampleSet/Download/"+a.id,responseType:"blob"}).then(h=>{const T=h.data,n=new Blob([T]);let c=h.headers["content-disposition"],l=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(c),I=decodeURI(l[1]);const m=document.createElement("a");m.download=I,m.target="_blank",m.style.display="none",m.href=URL.createObjectURL(n),document.body.appendChild(m),m.click(),URL.revokeObjectURL(m.href),document.body.removeChild(m)})},d=f(),g=a=>{d.value.show(a)},y=a=>{a.status=5,A.post("/api/ExampleSet/GenerateTile/"+a.id).then(()=>{})},D=a=>{fe.confirm("确认删除此样本库么？","提示",{showConfirmButton:!0,confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{A.post("/api/ExampleSet/Delete/"+a.id).then(()=>{$(),Z({type:"success",message:"删除成功"})})})};return(a,h)=>{const T=o("el-button"),n=o("el-input"),c=o("el-divider"),i=o("el-progress"),l=o("el-tag"),I=o("el-icon"),m=o("el-dropdown-item"),L=o("el-dropdown-menu"),q=o("el-dropdown");return p(),B(H,null,[e(Ee,{title:"样本管理",icon:"icon-wapianguanli"}),r("div",_t,[e(T,{type:"primary",icon:b(Se),onClick:J},{default:t(()=>[v("新建样本库")]),_:1},8,["icon"]),e(n,{modelValue:V.value,"onUpdate:modelValue":h[0]||(h[0]=C=>V.value=C),modelModifiers:{trim:!0},style:{width:"300px"},placeholder:"搜索您的数据",clearable:""},null,8,["modelValue"])]),e(c),r("div",ft,[r("div",vt,[(p(!0),B(H,null,F(P.value,(C,O)=>{var W;return p(),B("div",{class:"set",key:O},[r("div",gt,[r("div",yt,z(C.name),1),r("div",{class:"set-type",style:ae({color:(W=b(w)(C.type))==null?void 0:W.color})},[r("i",{class:Ie(["iconfont",b(G)(C.type)])},null,2),v(" "+z(b(k)(C.type)),1)],4)]),r("div",ht,[r("div",bt,[r("div",xt,[r("div",wt,[r("div",kt,z(C.labelCount),1),Ct])]),r("div",St,[r("div",It,[r("div",$t,z(C.tileImageCount),1),Et])])]),r("div",Vt,[(p(!0),B(H,null,F(C.tags,K=>(p(),R(X,{key:K.id,name:K.name,color:K.color},null,8,["name","color"]))),128))])]),e(i,{"stroke-width":2,percentage:C.progress,"show-text":!1,style:{margin:"16px 0"}},null,8,["percentage"]),r("div",Tt,[r("div",Lt,[e(T,{type:"primary",link:""},{default:t(()=>[v(z(b(x)(C.status)),1)]),_:2},1024),C.isReserved?(p(),R(l,{key:0,type:"success"},{default:t(()=>[v("已预约")]),_:1})):Q("",!0),C.updated?(p(),B("span",Rt,z(C.updated.substring(2,16)),1)):Q("",!0)]),e(q,{"split-button":"",onClick:K=>g(C),onCommand:K=>_(C,K)},{dropdown:t(()=>[e(L,null,{default:t(()=>[e(m,{command:"clip",disabled:N(C.status)},{default:t(()=>[v("执行切片")]),_:2},1032,["disabled"]),e(m,{command:"reserve",disabled:N(C.status)},{default:t(()=>[v("预约切片")]),_:2},1032,["disabled"]),e(m,{command:"download"},{default:t(()=>[v("下载")]),_:1}),e(m,{command:"delete"},{default:t(()=>[v("删除")]),_:1})]),_:2},1024)]),default:t(()=>[e(I,null,{default:t(()=>[e(b($e))]),_:1}),v(" 详情 ")]),_:2},1032,["onClick","onCommand"])])])}),128))])]),e(He,{ref_key:"exampleSetCreateRef",ref:u,onSuccess:$},null,512),e(mt,{ref_key:"exampleSetDetailRef",ref:d,onClose:$},null,512),e(Ye,{ref_key:"reserveClipRef",ref:s},null,512)],64)}}});const Jt=re(Bt,[["__scopeId","data-v-42387962"]]);export{Jt as default};
