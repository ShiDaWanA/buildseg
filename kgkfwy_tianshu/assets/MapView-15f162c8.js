/* empty css           */import{T as z,c as M,e as x,b as A,g as j,t as R,f as b,h as y,i as I,j as L,k as G,l as P,m as V,n as N,o as C,s as k,p as U,M as Y,V as X,q as B,d as D,F as Z,P as q,r as W,S as $,u as K,v as H,w as v,O as Q,_ as J,a as ee}from"./ImageInfo.vue_vue_type_script_setup_true_lang-abee9b6f.js";import{d as te,u as re,r as ie,M as se,H as ae,l as ne,o as O,e as le,f as w,h as oe,m as ce,z as ue,_ as de}from"./index-ab68adb5.js";function ge(m,e){const t=(""+m).split("."),r=(""+e).split(".");for(let i=0;i<Math.max(t.length,r.length);i++){const a=parseInt(t[i]||"0",10),s=parseInt(r[i]||"0",10);if(a>s)return 1;if(s>a)return-1}return 0}class he extends z{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",r=e.tileGrid!==void 0?e.tileGrid:M({extent:x(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const fe=he,T="1.3.0";class me extends z{constructor(e){e=e||{};const t=Object.assign({},e.params),r="TRANSPARENT"in t?t.TRANSPARENT:!0;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!r,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=A(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,r,i){const a=j(r),s=this.getProjection();let l=this.getTileGrid();l||(l=this.getTileGridForProjection(a));const u=l.getZForResolution(t,this.zDirection),o=l.getTileCoordForCoordAndZ(e,u);if(l.getResolutions().length<=o[0])return;let c=l.getResolution(o[0]),n=l.getTileCoordExtent(o,this.tmpExtent_),g=R(l.getTileSize(o[0]),this.tmpSize);const h=this.gutter_;h!==0&&(g=b(g,h,this.tmpSize),n=y(n,c*h,n)),s&&s!==a&&(c=I(s,a,e,c),n=L(n,a,s),e=G(e,a,s));const d={SERVICE:"WMS",VERSION:T,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(d,this.params_,i);const _=Math.floor((e[0]-n[0])/c),f=Math.floor((n[3]-e[1])/c);return d[this.v13_?"I":"X"]=_,d[this.v13_?"J":"Y"]=f,this.getRequestUrl_(o,g,n,1,s||a,d)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const r={SERVICE:"WMS",VERSION:T,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;r.LAYER=i}if(e!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,a=28e-5;r.SCALE=e*i/a}return Object.assign(r,t),P(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,r,i,a,s){const l=this.urls;if(!l)return;if(s.WIDTH=t[0],s.HEIGHT=t[1],s[this.v13_?"CRS":"SRS"]=a.getCode(),"STYLES"in this.params_||(s.STYLES=""),i!=1)switch(this.serverType_){case"geoserver":const n=90*i+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+n:s.FORMAT_OPTIONS="dpi:"+n;break;case"mapserver":s.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":s.DPI=90*i;break;default:V(!1,52);break}const u=a.getAxisOrientation(),o=r;if(this.v13_&&u.substr(0,2)=="ne"){let n;n=r[0],o[0]=r[1],o[1]=n,n=r[2],o[2]=r[3],o[3]=n}s.BBOX=o.join(",");let c;if(l.length==1)c=l[0];else{const n=N(C(e),l.length);c=l[n]}return P(c,s)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||T;this.v13_=ge(e,"1.3")>=0}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const a=i.getResolution(e[0]);let s=i.getTileCoordExtent(e,this.tmpExtent_),l=R(i.getTileSize(e[0]),this.tmpSize);const u=this.gutter_;u!==0&&(l=b(l,u,this.tmpSize),s=y(s,a*u,s)),t!=1&&(l=k(l,t,this.tmpSize));const o={SERVICE:"WMS",VERSION:T,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(e,l,s,t,r,o)}}const pe=me,_e={style:{position:"relative"}},Se={id:"datacenterMap",style:{height:"100%"}},Ee={id:"popup"},Te=te({__name:"MapView",props:{toolbar:{type:Boolean,default:!1}},emits:["imageClick"],setup(m,{emit:e}){const t=re(),r=ie({fileSize:0,fileType:"",created:"",name:"",srid:"",originalRasterXSize:0,originalRasterYSize:0,pixelDepth:0,numberOfBands:0,unit:"",resolution:0,originalResolution:0});let i=new U({}),a=new Y({view:new X({projection:"EPSG:3857",center:B([110,35]),zoom:4}),controls:D({attribution:!1,rotate:!1,zoom:!1})});se("map",a),ae(()=>{l(),s()});const s=()=>{ne.get("api/catalog/GetImages").then(u=>{i.clear(),u.forEach(o=>{let c=o.boundingBox,n=new Z({geometry:new q([[[c[0],c[1]],[c[0],c[3]],[c[2],c[3]],[c[2],c[1]],[c[0],c[1]]]])});n.setProperties(o),i.addFeature(n)})})},l=()=>{var g,h,d,_;let u=new W({source:i,style:new $({fill:new K({color:"rgba(255, 255, 255, 0.2)"}),stroke:new H({color:"#ffcc33",width:1})})}),o;(g=t.setting)!=null&&g.onlineMap?o=new v({source:new fe({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"})}):o=new v({source:new pe({url:`${(h=t.setting)==null?void 0:h.geoserver.publicUrl}/${(d=t.setting)==null?void 0:d.geoserver.workspace}/wms`,params:{VERSION:"1.1.1",LAYERS:(_=t.setting)==null?void 0:_.geoserver.baseLayer},projection:"EPSG:4326"})}),a.setTarget("datacenterMap"),a.setLayers([o,u]);let c=document.getElementById("popup"),n=new Q({element:c,autoPan:!1,positioning:"bottom-center"});a.on("pointermove",f=>{let S=a.getEventPixel(f.originalEvent),p=!1;a.forEachFeatureAtPixel(S,E=>{let F=f.coordinate;n.setPosition(F),E.getProperties().id&&(r.value=E.getProperties(),p=!0)}),p?a.addOverlay(n):a.removeOverlay(n)}),a.on("click",f=>{u.getFeatures(f.pixel).then(S=>{const p=S.length?S[0]:void 0;if(p){let E=p.getProperties();e("imageClick",E)}})})};return(u,o)=>(O(),le("div",_e,[w("div",Se,[w("div",Ee,[oe(J,{image:r.value,column:2},null,8,["image"])])]),m.toolbar?(O(),ce(ee,{key:0})):ue("",!0)]))}});const ve=de(Te,[["__scopeId","data-v-92ef1b9b"]]);export{ve as M};
